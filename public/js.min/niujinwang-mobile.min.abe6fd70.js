"use strict";angular.module("mobileApp").controller("MobileAddDepositCtrl",["$scope","$window","$timeout","$http","$location",function(a,b,c,d,e){var f=this;f.success=!1,f.user=b.bootstrappedUserObject,f.showCloseWindow=!1,f.user?(f.apply=a.data.currentApply,f.apply||e.path("/user_ttn")):(a.data||(a.data={}),a.data.lastLocation="/user_ttn_info",e.path("/login")),f.addDeposit=function(){return f.pay_amount?void d.post("/apply/add_deposit/"+f.apply.serialID,{deposit_amount:f.pay_amount}).success(function(a){return a.paid?(f.success=!0,void c(function(){f.success=!1,b.location.assign("/mobile/#/user_ttn_info/"+f.apply.serialID)},2e3)):(f.errorMsg="余额不足，请先充值",f.inputError=!0,void c(function(){f.inputError=!1},2500))}).error(function(a){f.errorMsg="追加失败 "+a.error_msg,f.inputError=!0,c(function(){f.inputError=!1},2500)}):(f.errorMsg="请输入有效的金额",f.inputError=!0,void c(function(){f.inputError=!1},2500))}}]),angular.module("mobileApp").controller("MobileApplyDetailCtrl",["$scope","$window","$location","$http","$timeout","days","util",function(a,b,c,d,e,f,g){var h=this;if(h.user=b.bootstrappedUserObject,h.showCloseWindow=!1,h.user){h.apply=b.bootstrappedApplyObject,h.apply.start_date=h.apply.startTime?h.apply.startTime:f.startTime(),h.apply.end_date=h.apply.endTime?h.apply.endTime:f.endTime(h.apply.start_date,h.apply.period),h.days_till_now=f.tradeDaysTillNow(h.apply),h.finalValue=h.apply.deposit+h.apply.profit,h.finalValue<0&&(h.finalValue=0);var i=0;null!==h.apply.profit&&void 0!==h.apply.profit&&(i=h.apply.profit),h.profit=i>=0?"+":"",h.profit+=i.toString(),h.profit_rate=0,i>0&&(h.profit_rate=i/h.apply.deposit*100),h.serviceFee=h.apply.isTrial?0:g.getServiceCharge(h.apply.lever),h.interest=h.apply.amount*h.apply.interestRate,h.apply_warn=h.apply.isTrial?1900:h.apply.warnValue?h.apply.warnValue:g.getWarnValue(h.apply.amount,h.apply.deposit),h.apply_sell=h.apply.isTrial?1800:h.apply.sellValue?h.apply.sellValue:g.getSellValue(h.apply.amount,h.apply.deposit)}else a.data||(a.data={}),a.data.lastLocation="/user_ttn_info",c.path("/login");h.requestClose=function(){h.showCloseWindow=!0},h.closeApply=function(){d.post("/user/apply_close/"+h.apply.serialID,{}).success(function(){h.apply.status=5,h.resultSuccess=!0,e(function(){h.resultSuccess=!1},2500),h.showCloseWindow=!1}).error(function(){h.errorMsg="结算申请提交失败，请稍后重试",h.resultError=!0,e(function(){h.resultError=!1},2500),h.showCloseWindow=!1})},h.addDeposit=function(){a.data.currentApply=h.apply,c.path("/add_deposit")},h.postponeApply=function(){a.data.currentApply=h.apply,c.path("/postpone_apply")}}]),angular.module("mobileApp").controller("MobileApplyListCtrl",["$scope","$window","$location","njApply","days","util",function(a,b,c,d,e,f){function g(a){a.start_date=a.startTime?a.startTime:e.startTime(),a.end_date=a.endTime?a.endTime:e.endTime(a.start_date,a.period),a.days_till_now=e.tradeDaysTillNow(a),a.left_days=a.period-a.days_till_now,a.apply_warn=a.isTrial?1900:a.warnValue?a.warnValue:f.getWarnValue(a.amount,a.deposit),a.apply_sell=a.isTrial?1800:a.sellValue?a.sellValue:f.getSellValue(a.amount,a.deposit)}var h=this;h.user=b.bootstrappedUserObject,h.apply_list={},h.user?h.apply_list=d.query({uid:h.user._id}).$promise.then(function(a){h.apply_list=a,angular.forEach(h.apply_list,function(a){g(a)})},function(){a.data||(a.data={}),a.data.lastLocation="/user_ttn",c.path("/login")}):(a.data||(a.data={}),a.data.lastLocation="/recharge_record",c.path("/login")),h.selectTTN=function(a){return 2!==a.type&&1!==a.status}}]),angular.module("mobileApp").controller("MobileChangePassCtrl",["$scope","$window","$location","$timeout","$interval","$http",function(a,b,c,d,e,f){var g=this;g.user=b.bootstrappedUserObject,g.user?(g.inputError=!1,g.resetSuccess=!1):(a.data||(a.data={}),a.data.lastLocation="/change_pass",c.path("/login")),g.changePassword=function(){if(!g.password)return g.inputError=!0,g.errorMsg="请输入登录密码，长度6到20位",void d(function(){g.inputError=!1},1500);if(!g.new_password)return g.inputError=!0,g.errorMsg="请输入新密码，长度6到20位",void d(function(){g.inputError=!1},1500);if(!g.confirm_password)return g.inputError=!0,g.errorMsg="请输入再输入一遍新密码",void d(function(){g.inputError=!1},1500);if(g.password===g.new_password)return g.inputError=!0,g.errorMsg="新密码不能与原密码相同",void d(function(){g.inputError=!1},1500);if(g.new_password!==g.confirm_password)return g.inputError=!0,g.errorMsg="两次输入的新密码不同",void d(function(){g.inputError=!1},1500);var a={password:g.password,new_password:g.new_password,confirm_password:g.confirm_password};f.post("/user/reset_pass",a).success(function(){g.resetSuccess=!0,d(function(){g.resetSuccess=!1,c.path("/account")},2500),console.log("success")}).error(function(a){g.inputError=!0,g.errorMsg=a.error_msg,d(function(){g.inputError=!1},1500)})}}]),angular.module("mobileApp").controller("MobileForgetCtrl",["$location","$timeout","$interval","$http",function(a,b,c,d){var e=this;e.showPass=!1,e.nextStep=!1,e.signupError=!1,e.verifyCodeBtnText="获取验证码",e.verifyBtnDisabled=!1,e.resetSuccess=!1,e.getVerifyCode=function(a){if(!e.verifyBtnDisabled){e.verifyBtnDisabled=!0;var b=0;e.verifyCodeBtnText="60秒后重试";var f=c(function(){++b,e.verifyCodeBtnText=60-b+"秒后重试",60===b&&(c.cancel(f),e.verifyCodeBtnText="获取验证码",e.verifyBtnDisabled=!1)},1e3),g=a?2:1;d.get("/api/send_sms_verify_code?mobile="+e.mobile+"&type="+g).success(function(){}).error(function(){})}},e.requestVerifyCode=function(){return e.mobile?void e.getVerifyCode(!0):(e.signupError=!0,e.errorMsg="请输入正确的手机号",void b(function(){e.signupError=!1},1500))},e.requestChangePassNext=function(){return e.mobile?e.verify_code?void(e.nextStep=!0):(e.errorMsg="请输入验证码",e.signupError=!0,void b(function(){e.signupError=!1},1500)):(e.signupError=!0,e.errorMsg="请输入正确的手机号",void b(function(){e.signupError=!1},1500))},e.requestChangePass=function(){return e.password?(e.confirm_password=e.password,void d.post("/forgot",{mobile:e.mobile,verify_code:e.verify_code,password:e.password,confirm_password:e.confirm_password}).success(function(){e.resetSuccess=!0,e.mobile="",e.verify_code="",e.password="",e.confirm_password="",b(function(){a.path("/")},2e3)}).error(function(a){e.signupError=!0,e.errorMsg=a.error_msg,b(function(){e.signupError=!1},1500)})):(e.signupError=!0,e.errorMsg="请输入密码，长度6到20位",void b(function(){e.signupError=!1},1500))},e.toggleShowPassword=function(){var a=$("#J_forgetSetPassword");e.showPass?a.attr("type","text"):a.attr("type","password")}}]),angular.module("mobileApp").controller("MobileHomeCtrl",["$scope","$window",function(){var a=this;a.menu=1}]),angular.module("mobileApp").controller("MobileIndexCtrl",["$scope","$window",function(a,b){a.data={},a.data.currentUser=b.bootstrappedUserObject}]),angular.module("mobileApp").controller("MobileLoginCtrl",["$scope","$location","$window","$timeout","$http",function(a,b,c,d,e){var f=this;f.loginError=!1,f.login=function(){return f.mobile&&f.password?void e.post("/api/login",{mobile:f.mobile,password:f.password}).success(function(d){a.data||b.path(d.location?d.location:"/user"),c.bootstrappedUserObject=d.user,b.path(a.data.lastLocation?a.data.lastLocation:"/")}).error(function(a){console.log("login error "+a.error_msg)}):(f.loginError=!0,void d(function(){f.loginError=!1},1500))}}]),angular.module("mobileApp").controller("MobilePostponeCtrl",["$scope","$window","$timeout","$http","$location",function(a,b,c,d,e){var f=this;f.success=!1,f.user=b.bootstrappedUserObject,f.showCloseWindow=!1,f.user?(f.apply=a.data.currentApply,f.apply||e.path("/user_ttn")):(a.data||(a.data={}),a.data.lastLocation="/user_ttn_info",e.path("/login")),f.postpone=function(){return f.period?void d.post("/apply/apply_postpone/"+f.apply.serialID,{period:f.period}).success(function(a){return a.paid?(f.success=!0,void c(function(){f.success=!1,b.location.assign("/mobile/#/user_ttn_info/"+f.apply.serialID)},2e3)):(f.errorMsg="余额不足，请先充值",f.inputError=!0,void c(function(){f.inputError=!1},2500))}).error(function(a){f.errorMsg="追加失败 "+a.error_msg,f.inputError=!0,c(function(){f.inputError=!1},2500)}):(f.errorMsg="请输入有效的日期",f.inputError=!0,void c(function(){f.inputError=!1},2500))}}]),angular.module("mobileApp").controller("MobileRechargeCtrl",["$scope","$window","$http","$timeout","$location","njOrder",function(a,b,c,d,e,f){function g(){i.pay_amount?(i.fee=.0035*i.pay_amount,i.fee<2&&(i.fee=2),i.fee=Number(i.fee.toFixed(2)),i.total_fee=i.fee+i.pay_amount,i.total_fee=Number(i.total_fee.toFixed(2))):(i.fee=0,i.total_fee=0)}var h,i=this;i.bankList=[{name:"中国工商银行",code:"ICBC_D_B2C",value:0},{name:"中国农业银行",code:"ABC_D_B2C",value:1},{name:"中国建设银行",code:"CCB_D_B2C",value:2},{name:"民生银行",code:"CMBCD_D_B2C",value:3},{name:"中国银行",code:"BOCSH_D_B2C",value:4},{name:"招商银行",code:"CMB_D_B2C",value:5},{name:"兴业银行",code:"CIB_D_B2C",value:6},{name:"光大银行",code:"CEB_D_B2C",value:7},{name:"广发银行",code:"GDB_D_B2C",value:8}],i.user_bank=i.bankList[0],i.user=b.bootstrappedUserObject,i.user?(i.smsSend=!1,i.inputError=!1,i.alipayConfirm=!1,i.orderCreateSuccess=!1,i.showVerifyCodeWindow=!1,i.finishOnlinePayWindow=!1,i.processing=!1,i.pay_order=b.bootstrappedOrderObject,i.fee=0,i.total_fee=0,i.pay_order&&(i.user.finance.balance>0?(i.pay_amount=Number((i.pay_order.amount-i.user.finance.balance).toFixed(2)),i.pay_amount<0&&(i.pay_amount=0)):i.pay_amount=Number(i.pay_order.amount.toFixed(2)),g()),i.alipayAccountConfirm=!1,i.user.profile.alipay_account&&(i.alipayAccountConfirm=!0,i.alipay_account=i.user.profile.alipay_account,i.alipay_name=i.user.profile.alipay_name)):(a.data||(a.data={}),a.data.lastLocation="/user",e.path("/login")),i.sendSMSBankInfo=function(){if(!i.smsSend){i.smsSend=!0,d(function(){i.smsSend=!1},6e4);var a="户名：北京小牛普惠科技有限公司，账号：110912609510501，开户行：招商银行股份有限公司北京清华园支行";c.post("/api/send_sms",{sms_content:a}).success(function(){console.log("success")}).error(function(){console.log("fail")})}},i.aliPay=function(){if(!i.alipay_account)return i.errorMsg="请输入支付宝账户",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.alipay_name)return i.errorMsg="请输入支付宝实名认证姓名",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.pay_amount||i.pay_amount<0)return i.errorMsg="请输入有效的充值金额",i.inputError=!0,void d(function(){i.inputError=!1},1500);i.alipayConfirm=!0;var a=new f({uid:i.user._id});i.pay_order?(i.pay_order.description+=" 支付宝转账(移动)",i.pay_order.amount=i.pay_amount,i.pay_order.payType=3,i.pay_order.otherInfo=i.alipay_account,i.pay_order.transID=i.alipay_name,c.post("/api/user/"+i.user._id+"/orders/"+i.pay_order._id,i.pay_order).success(function(){}).error(function(){console.log("order update failed"),i.errorMsg="服务暂时不可用，请稍后再试",i.inputError=!0,d(function(){i.inputError=!1},1500)})):(a.userID=i.user._id,a.userMobile=i.user.mobile,a.dealType=1,a.amount=Number(i.pay_amount.toFixed(2)),a.description="支付宝转账(移动)",a.payType=3,a.status=2,a.otherInfo=i.alipay_account,a.transID=i.alipay_name,a.$save(function(){},function(){i.errorMsg="服务暂时不可用，请稍后再试",i.inputError=!0,d(function(){i.inputError=!1},1500)}))},i.onlinePayStepOneForFirstTime=function(){if(!i.processing){if(!i.pay_amount||i.pay_amount<0)return i.errorMsg="请输入有效的充值金额,2至100元",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.user_name)return i.errorMsg="请输入姓名",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.user_id)return i.errorMsg="请输入身份证号",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.user_bank)return i.errorMsg="请选择银行",i.inputError=!0,void d(function(){i.inputError=!1},1500);var a=/^(\d{16}|\d{17}|\d{18}|\d{19})$/;if(!a.test(i.user_bank_card_id))return i.errorMsg="请输入银行卡号,16到19位数字",i.inputError=!0,void d(function(){i.inputError=!1},1500);if(!i.user_mobile)return i.errorMsg="请输入银行预留手机号",i.inputError=!0,void d(function(){i.inputError=!1},1500);var b={amount:i.pay_amount,total_fee:i.total_fee,real_name:i.user_name,cert_no:i.user_id,bank_code:i.user_bank.code,card_no:i.user_bank_card_id,card_bind_mobile_phone_no:i.user_mobile};i.pay_order&&(b.out_trade_no=i.pay_order._id),h=b,i.processing=!0,c.post("/user/beifu_get_dyncode",b).success(function(a){i.processing=!1,i.showVerifyCodeWindow=!0,h.token=a.token,h.out_trade_no=a.order_id}).error(function(a){i.processing=!1,i.errorMsg=a.error_msg,i.inputError=!0,d(function(){i.inputError=!1},1500)})}},i.onlinePayStepOne=function(){if(!i.processing){if(!i.pay_amount||i.pay_amount<0)return i.errorMsg="请输入有效的充值金额,0.01至98元",i.inputError=!0,void d(function(){i.inputError=!1},1500);var a={amount:i.pay_amount,total_fee:i.total_fee,firstPay:!1};i.pay_order&&(a.out_trade_no=i.pay_order._id),h=a,i.processing=!0,c.post("/user/beifu_get_dyncode",a).success(function(a){i.processing=!1,i.showVerifyCodeWindow=!0,h.token=a.token,h.out_trade_no=a.order_id}).error(function(a){i.processing=!1,i.errorMsg=a.error_msg,i.inputError=!0,d(function(){i.inputError=!1},1500)})}},i.onlinePayStepTwo=function(){return i.verify_code?(h.exter_invoke_ip=b.returnCitySN.cip,h.verify_code=i.verify_code,i.processing=!0,void c.post("/user/beifu_pay",h).success(function(){i.processing=!1,i.showVerifyCodeWindow=!1,i.finishOnlinePayWindow=!0}).error(function(a){i.processing=!1,i.errorMsg=a.error_msg,i.inputError=!0,d(function(){i.inputError=!1},1500)})):(i.errorMsg="请输入验证码",i.inputError=!0,void d(function(){i.inputError=!1},1500))},i.confirmAlipay=function(){i.orderCreateSuccess=!0},i.finish=function(){e.path("/recharge")},i.useBankTransPay=function(){e.path("/recharge_bank")},i.selectBank=function(){console.log(i.user_bank.name)},i.gotoApply=function(){e.path("/ttn")},i.inputPayAmount=function(){g()}}]),angular.module("mobileApp").controller("MobileRechargeRecordCtrl",["$scope","$window","$resource","$location",function(a,b,c,d){var e=this;if(e.user=b.bootstrappedUserObject,e.orderList={},e.user){var f=c("/api/mobile_recharge/orders",{});e.orderList=f.query().$promise.then(function(a){e.orderList=a},function(){a.data||(a.data={}),a.data.lastLocation="/recharge_record",d.path("/login")})}else a.data||(a.data={}),a.data.lastLocation="/recharge_record",d.path("/login")}]),angular.module("mobileApp").controller("MobileSignupCtrl",["$scope","$location","$timeout","$http","$interval",function(a,b,c,d,e){var f=this;f.signupError=!1,f.verifyCodeBtnText="获取验证码",f.verifyBtnDisabled=!1,f.signup=function(){if(!f.mobile)return f.signupError=!0,f.errorMsg="请输入正确的手机号",void c(function(){f.signupError=!1},1500);if(!f.password)return f.signupError=!0,f.errorMsg="请输入密码，长度6到20位",void c(function(){f.signupError=!1},1500);if(!f.confirm_password)return f.signupError=!0,f.errorMsg="请再输一遍密码，长度6到20位",void c(function(){f.signupError=!1},1500);if(f.password!=f.confirm_password)return f.signupError=!0,f.errorMsg="两次密码应该保持一致",void c(function(){f.signupError=!1},1500);var a={mobile:f.mobile,password:f.password,confirm_password:f.confirm_password};d.post("/api/signup",a).success(function(){f.show_verify_window=!0,f.getVerifyCode()}).error(function(a){f.errorMsg=a.error_msg,f.signupError=!0,c(function(){f.signupError=!1},1500)})},f.getVerifyCode=function(a){if(!f.verifyBtnDisabled){f.verifyBtnDisabled=!0;var b=0;f.verifyCodeBtnText="60秒后重试";var c=e(function(){++b,f.verifyCodeBtnText=60-b+"秒后重试",60===b&&(e.cancel(c),f.verifyCodeBtnText="获取验证码",f.verifyBtnDisabled=!1)},1e3),g=a?2:1;d.get("/api/send_sms_verify_code?mobile="+f.mobile+"&type="+g).success(function(){}).error(function(){})}},f.confirmVerifyCode=function(){return f.verify_code?4!=f.verify_code.length?(f.errorMsg="验证码错误，请重新输入",f.signupError=!0,void c(function(){f.signupError=!1},1500)):void d.post("/finish_signup",{mobile:f.mobile,verify_code:f.verify_code}).success(function(){f.signupSuccess=!0,c(function(){b.path("/")},2e3)}).error(function(a){f.errorMsg=a.error_msg,f.signupError=!0,c(function(){f.signupError=!1},1500)}):(f.errorMsg="请输入验证码",f.signupError=!0,void c(function(){f.signupError=!1},1500))}}]),angular.module("mobileApp").controller("MobileTtnConfirmCtrl",["$scope","$window","$location","$http","days","util",function(a,b,c,d,e,f){function g(){h.serviceFee=h.apply.amount/1e4*f.getServiceCharge(h.apply.lever)*h.apply.period,h.totalAmount=h.apply.deposit+h.serviceFee,h.shouldPay=h.totalAmount-h.apply.userBalance,h.shouldPay<=0?(h.shouldPay=0,h.balancePay=!0):h.balancePay=!1}var h=this;h.apply={},b.bootstrappedApplyObject&&angular.extend(h.apply,b.bootstrappedApplyObject),h.validDays=[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],h.autoPostpone=!0,g(),h.selectDay=function(){g()},h.payForApply=function(){h.apply.autoPostpone=h.autoPostpone,h.apply.shouldPay=h.shouldPay,h.apply.totalAmount=h.totalAmount,d.post("/apply_confirm",h.apply).success(function(a){if(0===h.shouldPay){var c={apply_serial_id:a.apply.serialID,order_id:a.order._id};d.post("/api/users/pay_by_balance",c).success(function(){b.location.assign("/mobile/apply/pay_success?serial_id="+a.apply.serialID+"&amount="+a.apply.amount)}).error(function(a){console.log("error:"+a.error_msg)})}else b.location.assign("/mobile/#/recharge_alipay?order_id="+a.order._id)}).error(function(a,b){403===b&&alert("对不起，同一用户最多只能有5笔操盘中的配资。暂不能再申请新的配资。"),console.log("error:"+a.reason)})}}]),angular.module("mobileApp").controller("MobileTtnCtrl",["$scope","$window","$location","$http","days","util",function(a,b,c,d,e,f){function g(){k.summary.lever=k.selectedLever.value,k.summary.deposit=k.summary.amount*m,k.summary.warnValue=f.getWarnValue(k.summary.amount,k.summary.deposit),k.summary.sellValue=f.getSellValue(k.summary.amount,k.summary.deposit),k.summary.serviceCharge=f.getServiceCharge(k.summary.lever);var a=k.summary.amount/1e4*k.summary.serviceCharge;k.summary.charge=a,k.summary.total=k.summary.deposit+a,k.endTime=e.endTime(l,k.summary.day)}function h(){angular.forEach(k.amountList,function(a){a.select=!1})}function i(){k.otherAmount>=k.min_amount?k.otherAmount<=k.max_amount?k.summary.amount=Math.floor(k.otherAmount):k.otherAmount=k.summary.amount=k.max_amount:k.summary.amount=0,g()}function j(){d.post("/apply",k.summary).success(function(a){console.log("success "+a.apply_serial_id),c.path("/ttn_confirm/"+a.apply_serial_id)}).error(function(b,d){401===d?(a.data.lastLocation="/ttn",c.path("/login")):console.log(b.error_msg)})}var k=this;k.min_amount=2e3,k.max_amount=3e5;var l=e.startTime();k.leverList=[{name:"8倍",value:8},{name:"7倍",value:7},{name:"6倍",value:6},{name:"5倍",value:5},{name:"4倍",value:4},{name:"3倍",value:3},{name:"2倍",value:2}],k.agree=!0,k.showOtherAmount=!1,k.otherAmount,k.selectedLever=k.leverList[0],k.summary={day:1,amount:2e3},k.endTime=e.endTime(l,k.summary.day);var m=1/k.selectedLever.value;g(),k.amountList=[{name:"2000元",value:"2000",select:!0},{name:"1万",value:"10000"},{name:"2万",value:"20000"},{name:"3万",value:"30000"},{name:"5万",value:"50000"},{name:"10万",value:"100000"},{name:"20万",value:"200000"},{name:"30万",value:"300000"}],k.selectAmount=function(a){h(),k.showOtherAmount=!1,a.select=!0,k.summary.amount=a.value,g()},k.toggleOtherAmount=function(){k.showOtherAmount=!k.showOtherAmount,k.showOtherAmount?i():k.selectAmount(k.amountList[0])},k.finishOtherAmount=function(){i()},k.submitApply=function(){return k.agree?k.summary.amount<=0||k.summary.amount>3e5?void alert("金额必须在2000元到30万之间"):void j():void alert("您必须同意《牛金操盘协议》")},k.leverChange=function(){m=1/k.selectedLever.value,g()}}]),angular.module("mobileApp").controller("MobileUserCtrl",["$scope","$window","$location","$http",function(a,b,c,d){var e=this;e.user=b.bootstrappedUserObject,e.user||(a.data||(a.data={}),a.data.lastLocation="/user",c.path("/login")),e.menu=4,e.logout=function(){d.post("/logout",{}).success(function(){a.data.currentUser=null,b.bootstrappedUserObject=null,c.path("/")}).error(function(){})}}]),angular.module("mobileApp").controller("MobileYynConfirmCtrl",["$scope","$window","$http",function(a,b,c){var d=this;d.apply={},b.bootstrappedApplyObject&&angular.extend(d.apply,b.bootstrappedApplyObject),d.interest=(d.apply.amount-d.apply.deposit)*d.apply.interestRate,d.totalAmount=d.apply.deposit+d.interest,d.shouldPay=d.totalAmount-d.apply.userBalance,d.shouldPay<=0?(d.shouldPay=0,d.balancePay=!0):d.balancePay=!1,d.payForApply=function(){d.apply.shouldPay=d.shouldPay,d.apply.totalAmount=d.totalAmount,c.post("/apply_confirm",d.apply).success(function(a){if(0===d.shouldPay){var e={apply_serial_id:a.apply.serialID,order_id:a.order._id};c.post("/api/users/pay_by_balance",e).success(function(){b.location.assign("/mobile/apply/pay_success?serial_id="+a.apply.serialID+"&amount="+a.apply.amount)}).error(function(a){console.log("error:"+a.error_msg)})}else b.location.assign("/mobile/#/recharge_alipay?order_id="+a.order._id)}).error(function(a,b){403===b&&alert("对不起，同一用户最多只能有5笔操盘中的配资。暂不能再申请新的配资。"),console.log("error:"+a.reason)})}}]),angular.module("mobileApp").controller("MobileYynCtrl",["$scope","$window","$http","$location","util",function(a,b,c,d,e){var f=this;f.summary={},f.summary.deposit=0,f.summary.warnValue=0,f.summary.sellValue=0,f.parameterList=[{name:"2倍",interest:1.2,value:2,i_value:.012},{name:"3倍",interest:1.3,value:3,i_value:.013},{name:"4倍",interest:1.6,value:4,i_value:.016},{name:"5倍",interest:1.7,value:5,i_value:.017},{name:"6倍",interest:1.8,value:6,i_value:.018}],f.periodList=[];for(var g=1;6>=g;++g){var h={name:g+"个月",value:g};f.periodList.push(h)}f.selectedValue=f.parameterList[0],f.selectedMonth=f.periodList[0],f.summary.month=1,f.summary.charge=0,f.selectLever=function(a){f.selectedValue=a,f.calculateValue()},f.calculateValue=function(){if(f.summary.amount>=5e5&&f.summary.amount<=3e6){f.summary.lever=f.selectedValue.value,f.summary.deposit=f.summary.amount/f.selectedValue.value,f.summary.warnValue=e.getWarnValue(f.summary.amount,f.summary.deposit),f.summary.sellValue=e.getSellValue(f.summary.amount,f.summary.deposit);var a=(f.summary.amount-f.summary.deposit)*f.selectedValue.i_value;f.summary.charge=a}else f.summary.deposit=0,f.summary.warnValue=0,f.summary.sellValue=0,f.summary.charge=0},f.monthChange=function(){f.summary.month=f.selectedMonth.value,f.calculateValue()},f.submitApply=function(){return f.summary.deposit<=0?void alert("请输入有效资金,最低50万,最高300万"):(f.summary.type=2,f.summary.interestRate=f.selectedValue.i_value,void c.post("/apply",f.summary).success(function(a){d.path("/yyn_confirm/"+a.apply_serial_id)}).error(function(b,c){401===c?(a.data.lastLocation="/yyn",d.path("/login")):console.log(b.error_msg)}))}}]),function(){var a=[moment("2015-03-14").dayOfYear(),moment("2015-03-15").dayOfYear(),moment("2015-03-21").dayOfYear(),moment("2015-03-22").dayOfYear(),moment("2015-03-28").dayOfYear(),moment("2015-03-29").dayOfYear(),moment("2015-04-04").dayOfYear(),moment("2015-04-05").dayOfYear(),moment("2015-04-06").dayOfYear(),moment("2015-04-11").dayOfYear(),moment("2015-04-12").dayOfYear(),moment("2015-04-18").dayOfYear(),moment("2015-04-19").dayOfYear(),moment("2015-04-25").dayOfYear(),moment("2015-04-26").dayOfYear(),moment("2015-05-01").dayOfYear(),moment("2015-05-02").dayOfYear(),moment("2015-05-03").dayOfYear(),moment("2015-05-09").dayOfYear(),moment("2015-05-10").dayOfYear(),moment("2015-05-16").dayOfYear(),moment("2015-05-17").dayOfYear(),moment("2015-05-23").dayOfYear(),moment("2015-05-24").dayOfYear(),moment("2015-06-06").dayOfYear(),moment("2015-06-07").dayOfYear(),moment("2015-06-13").dayOfYear(),moment("2015-06-14").dayOfYear(),moment("2015-06-20").dayOfYear(),moment("2015-06-21").dayOfYear(),moment("2015-06-22").dayOfYear(),moment("2015-06-27").dayOfYear(),moment("2015-06-28").dayOfYear(),moment("2015-07-04").dayOfYear(),moment("2015-07-05").dayOfYear(),moment("2015-07-11").dayOfYear(),moment("2015-07-12").dayOfYear(),moment("2015-07-18").dayOfYear(),moment("2015-07-19").dayOfYear(),moment("2015-07-25").dayOfYear(),moment("2015-07-26").dayOfYear(),moment("2015-08-01").dayOfYear(),moment("2015-08-02").dayOfYear(),moment("2015-08-08").dayOfYear(),moment("2015-08-09").dayOfYear(),moment("2015-08-15").dayOfYear(),moment("2015-08-16").dayOfYear(),moment("2015-08-22").dayOfYear(),moment("2015-08-23").dayOfYear(),moment("2015-08-29").dayOfYear(),moment("2015-08-30").dayOfYear(),moment("2015-09-05").dayOfYear(),moment("2015-09-06").dayOfYear(),moment("2015-09-12").dayOfYear(),moment("2015-09-13").dayOfYear(),moment("2015-09-19").dayOfYear(),moment("2015-09-20").dayOfYear(),moment("2015-09-26").dayOfYear(),moment("2015-09-27").dayOfYear(),moment("2015-10-01").dayOfYear(),moment("2015-10-02").dayOfYear(),moment("2015-10-03").dayOfYear(),moment("2015-10-04").dayOfYear(),moment("2015-10-05").dayOfYear(),moment("2015-10-06").dayOfYear(),moment("2015-10-07").dayOfYear(),moment("2015-10-10").dayOfYear(),moment("2015-10-11").dayOfYear(),moment("2015-10-17").dayOfYear(),moment("2015-10-18").dayOfYear(),moment("2015-10-24").dayOfYear(),moment("2015-10-25").dayOfYear(),moment("2015-10-31").dayOfYear(),moment("2015-11-01").dayOfYear(),moment("2015-11-07").dayOfYear(),moment("2015-11-08").dayOfYear(),moment("2015-11-14").dayOfYear(),moment("2015-11-15").dayOfYear(),moment("2015-11-21").dayOfYear(),moment("2015-11-22").dayOfYear(),moment("2015-11-28").dayOfYear(),moment("2015-11-29").dayOfYear(),moment("2015-12-05").dayOfYear(),moment("2015-12-06").dayOfYear(),moment("2015-12-12").dayOfYear(),moment("2015-12-13").dayOfYear(),moment("2015-12-19").dayOfYear(),moment("2015-12-20").dayOfYear(),moment("2015-12-26").dayOfYear(),moment("2015-12-27").dayOfYear()],b=function(){var b=moment().startOf("day");for(moment().hour()>=14&&(b=moment().endOf("day").add(1,"ms"));;){var c=b.dayOfYear();if(-1===a.indexOf(c))break;b=b.add(1,"day")}return b},c=function(b,c,d){var e=b.clone();if(d&&2===d){for(e=e.add(c,"months");-1!==a.indexOf(e.dayOfYear());)e=e.add(1,"day");return e}for(--c;c;)e=e.add(1,"day"),-1===a.indexOf(e.dayOfYear())&&--c;return e.hour(14),e.minute(50),e.second(0),e},d=function(b){for(var c=moment(b).dayOfYear(),d=moment().dayOfYear(),e=0;d>=c;)-1===a.indexOf(d)&&++e,--d;return e};angular.module("commonApp",[]),angular.module("commonApp").value("gbToastr",toastr),angular.module("commonApp").factory("gbNotifier",["gbToastr",function(a){return{notify:function(b){a.success(b)},error:function(b){a.error(b)}}}]),angular.module("commonApp").filter("numTrunc",function(){return function(a){if(a){var b=a.toString(),c=b.search("\\.");c>-1&&(b=b.substr(c))}return b}}).filter("integerNum",function(){return function(a){var b=a,c=b.search("\\.");return c>-1&&(b=b.substr(0,c)),b}}).filter("displayManager",function(){return function(a){switch(a){case"13520978346":return"秦亚景";case"13488867185":return"姜涛";case"17709810065":return"刘恩泽";case"18911347741":return"刘瑞";case"18511565878":return"刘亚东";case"15101183931":return"孟雪";case"18931040286":return"魏昊庚";default:return a}}}).filter("displayOrderAmount",function(){return function(a,b){var c="";return(2===b||9===b)&&(c="-"),c+a}}).filter("displayIncome",["$filter",function(a){return function(b,c){var d=b;return 2==c||9==c||10==c?"":a("currency")(d,"",2)}}]).filter("displayOutcome",["$filter",function(a){return function(b,c){var d="";return(2==c||9==c||10==c)&&(d=a("currency")(b,"",2)),d}}]).filter("displayMobile",function(){return function(a){return a?(a=a.toString(),a.substr(0,3)+"****"+a.substr(-4)):""}}).filter("displayEmail",function(){return function(a){if(a){var b=a.search("@");return a.substr(0,2)+"***"+a.substr(b)}return""}}).filter("displayIdentityID",function(){return function(a){return a?a.substr(0,4)+"**********"+a.substr(-4):""}}).filter("displayDate",function(){return function(a){return moment(a).format("YYYY-MM-DD HH:mm")}}).filter("displayShortDate",function(){return function(a){return moment(a).format("YYYY-MM-DD")}}).filter("displayCard",["BankNameList",function(a){return function(b){if(b&&b.cardID){var c=b.cardID.toString().substr(12);return a[b.bankID].name+" **** **** **** "+c}return""}}]).filter("displayCard3",function(){return function(a){if(a&&a.cardID){var b=a.cardID.toString().substr(-4),c=a.cardID.toString().substr(0,4);return c+" **** **** "+b}return""}}).filter("displayCard2",["BankNameList",function(){return function(a){if(a&&a.cardID){var b=a.cardID.toString().substr(-4);return b}return""}}]).filter("orderStatus",function(){return function(a){switch(a){case 0:return"等待确认";case 1:return"交易成功";case 2:return"未支付";default:return"未支付"}}}).filter("displayOrderType",function(){return function(a){switch(a){case 1:return"充值";case 2:return"提现";case 3:return"盈利提取";case 4:return"股票盈利";case 5:return"保证金返还";case 6:return"追加配资保证金";case 7:return"配资延期";case 8:return"管理费返还";case 9:return"保证金支出";case 10:return"管理费支出";default:return"充值"}}}).filter("applyStatus",function(){return function(a){switch(a){case 1:return"待支付";case 2:return"操盘中";case 3:return"已结算";case 4:return"审核中";case 5:return"结算中";case 9:return"排队中";default:return"待支付"}}}).filter("payType",function(){return function(a){switch(a){case 0:return"爱贝";case 1:return"盛付通";case 2:return"股票配资盈利";case 3:return"支付宝";case 4:return"银行转账";default:return"无"}}}).service("days",function(){this.startTime=b,this.endTime=c,this.tradeDaysTillNow=d}).service("util",["warn_factor","sell_factor",function(a,b){this.serviceCharge=19.9,this.getServiceCharge=function(a){switch(a){case 10:return 19.9;case 9:return 18.9;case 8:return 19.9;case 7:return 18.9;case 6:return 17.9;case 5:return 14.9;case 4:return 13.9;case 3:return 10.9;case 2:return 9.9;default:return 19.9}},this.getServiceFee=function(a,b){return a.type&&2===a.type?Number(((a.amount-a.amount/a.lever)*a.interestRate).toFixed(2)):(b||(b=a.period),Number((a.amount/1e4*(a.serviceCharge?a.serviceCharge:this.getServiceCharge(a.lever))*b).toFixed(2)))},this.getWarnValue=function(b,c){return Number((b-a*c).toFixed(2))},this.getSellValue=function(a,c){return Number((a-b*c).toFixed(2))}}]);var e=[{name:"register_content",value:0,content:"验证码：CODE，用于注册，欢迎来到牛金网，为您提供专业贴心的配资服务。"},{name:"reset_pass_content",value:1,content:"验证码：CODE，用于密码重置，请勿泄露给他人！"},{name:"approve_apply_sms_content",value:2,content:"AMOUNT元资金已到账，股票账号ACCOUNT，登录密码PASSWORD，请勿向任何人泄露！"},{name:"close_apply_sms_content",value:3,content:"业务结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元）已完成，祝您投资愉快。"},{name:"pay_success_sms_content",value:4,content:"充值AMOUNT元已经到账，祝您投资愉快。"},{name:"warn_sms_content",value:5,content:"您的账户（XXXXXXXX）的操盘业务已经亏损到达警戒线，请尽快追加至少XXXX元保证金以维持仓位。"},{name:"sell_sms_content",value:6,content:"金额为AMOUNT元的操盘业务已经亏损到达平仓线SELL_AMOUNT元，系统已经将交易账户平仓，请登录牛金网查看相应信息。"},{name:"withdraw_content",value:7,content:"AMOUNT元资金提现已完成，请注意查收，当前牛金可用余额为BALANCE元。"}];angular.module("commonApp").constant("withdraw_sms_content","您于TIME在牛金网提现AMOUNT元，提现已完成，请注意查收，").constant("get_profit_sms_content","您的盈利提取申请已经处理，资金已划入您在牛金网的余额").constant("approve_apply_sms_content","您有一笔金额为AMOUNT元配资资金已到账，交易账号ACCOUNT，登录密码PASSWORD，您可以通过手机或电脑进行操盘，可以登录牛金网，在我的账户中查看相应账户信息，操盘账户是您操盘的唯一依据，请不要向任何人泄露！").constant("close_apply_sms_content","您在牛金网有一笔TOTAL_AMOUNT元的配资业务已经结算完毕，根据您的操盘收益，该笔配资实际结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元），祝您投资愉快。").constant("pay_success_sms_content","您于TIME在牛金网充值AMOUNT元，资金已经到账，感谢您对牛金网的支持，祝您投资愉快。").constant("warn_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达警戒线WARN_AMOUNT元，请尽快追加保证金以维持仓位，您可以登录牛金网进行操作，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sell_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达平仓线SELL_AMOUNT元，系统已经将交易账户平仓，请登录牛金网查看相应信息，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sms_macro",e).constant("service_charge",19.9).constant("warn_factor",.4).constant("sell_factor",.6),angular.module("commonApp").constant("BankNameList",[{name:"工商银行",img:"/images/yh/icbc.jpg",instCode:"ICBC",credit:!0,value:0},{name:"建设银行",img:"/images/yh/cbc.jpg",instCode:"CCB",credit:!0,value:1},{name:"农业银行",img:"/images/yh/abc.jpg",instCode:"ABC",credit:!0,value:2},{name:"中国银行",img:"/images/yh/boc.png",instCode:"BOC",credit:!0,value:3},{name:"招商银行",img:"/images/yh/cmb.jpg",instCode:"CMB",credit:!0,value:4},{name:"交通银行",img:"/images/yh/bcs.png",instCode:"COMM",credit:!0,value:5},{name:"邮政储蓄银行",img:"/images/yh/psbc.png",instCode:"PSBC",credit:!1,value:6},{name:"广发银行",img:"/images/yh/cgb.png",instCode:"GDB",credit:!0,value:7},{name:"光大银行",img:"/images/yh/ceb.png",instCode:"CEB",credit:!0,value:8},{name:"兴业银行",img:"/images/yh/cib.png",instCode:"CIB",credit:!0,value:9},{name:"北京银行",img:"/images/yh/bob.png",instCode:"BCCB",credit:!1,value:10},{name:"浦发银行",img:"/images/yh/spdb.png",instCode:"SPDB",credit:!0,value:11},{name:"民生银行",img:"/images/yh/cmbc.png",instCode:"CMBC",credit:!0,value:12},{name:"中信银行",img:"/images/yh/ecitic.png",instCode:"CITIC",credit:!0,value:13},{name:"华夏银行",img:"/images/yh/hx-2.png",instCode:"HXB",credit:!1,value:14},{name:"平安银行",img:"/images/yh/pa.png",instCode:"SZPAB",credit:!0,value:15},{name:"宁波银行",img:"/images/yh/nbcb.png",instCode:"NBCB",credit:!1,value:16},{name:"上海银行",img:"/images/yh/bos.png",instCode:"BOS",credit:!0,value:17}]),angular.module("commonApp").factory("njUser",["$resource",function(a){var b=a("/api/user/:id",{id:"@_id"});
return b}]),angular.module("commonApp").factory("njApply",["$resource",function(a){var b=a("/api/user/:uid/applies/:serial_id",{uid:"@userID",serial_id:"@serialID"});return b}]),angular.module("commonApp").factory("njOrder",["$resource",function(a){var b=a("/api/user/:uid/orders/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("commonApp").factory("njCard",["$resource",function(a){var b=a("/api/cards/:uid",{userID:"@uid"});return b}]),angular.module("commonApp").factory("njCachedCards",["njCard",function(a){var b,c;return{setUID:function(a){c=a},query:function(){return b||(b=a.query({uid:c})),b}}}])}();