"use strict";function copycode1(a){var b=document.getElementById(a);if(is_ie&&"none"!=b.style.display){alert("复制成功");var c=document.body.createTextRange();c.moveToElementText(b),c.scrollIntoView(),c.select(),c.execCommand("Copy"),c.collapse(!1)}else alert("该浏览器不支持此功能，请Ctrl+C复制")}$(function(){$(".jq_topLogin").hover(function(){$(".jq_LoginBox").show(),$(this).addClass("TopLoginBoxSelected")},function(){$(".jq_LoginBox").hide(),$(this).removeClass("TopLoginBoxSelected")}),$(".jq_khdBox").hover(function(){$(this).find("div").show(),$(this).addClass("khdBoxSelected")},function(){$(this).find("div").hide(),$(this).removeClass("khdBoxSelected")}),$(".errorText").click(function(){$(this).hide(),$(this).prev("input").focus()}),$(".login-btn").click(function(){$(".errorText").show()})});var lang=new Array,userAgent=navigator.userAgent.toLowerCase(),is_opera=-1!=userAgent.indexOf("opera")&&opera.version(),is_moz="Gecko"==navigator.product&&userAgent.substr(userAgent.indexOf("firefox")+8,3),is_ie=-1!=userAgent.indexOf("msie")&&!is_opera&&userAgent.substr(userAgent.indexOf("msie")+5,3);!function(){var a=[moment("2015-03-14").dayOfYear(),moment("2015-03-15").dayOfYear(),moment("2015-03-21").dayOfYear(),moment("2015-03-22").dayOfYear(),moment("2015-03-28").dayOfYear(),moment("2015-03-29").dayOfYear(),moment("2015-04-04").dayOfYear(),moment("2015-04-05").dayOfYear(),moment("2015-04-06").dayOfYear(),moment("2015-04-11").dayOfYear(),moment("2015-04-12").dayOfYear(),moment("2015-04-18").dayOfYear(),moment("2015-04-19").dayOfYear(),moment("2015-04-25").dayOfYear(),moment("2015-04-26").dayOfYear(),moment("2015-05-01").dayOfYear(),moment("2015-05-02").dayOfYear(),moment("2015-05-03").dayOfYear(),moment("2015-05-09").dayOfYear(),moment("2015-05-10").dayOfYear(),moment("2015-05-16").dayOfYear(),moment("2015-05-17").dayOfYear(),moment("2015-05-23").dayOfYear(),moment("2015-05-24").dayOfYear(),moment("2015-06-06").dayOfYear(),moment("2015-06-07").dayOfYear(),moment("2015-06-13").dayOfYear(),moment("2015-06-14").dayOfYear(),moment("2015-06-20").dayOfYear(),moment("2015-06-21").dayOfYear(),moment("2015-06-22").dayOfYear(),moment("2015-06-27").dayOfYear(),moment("2015-06-28").dayOfYear(),moment("2015-07-04").dayOfYear(),moment("2015-07-05").dayOfYear(),moment("2015-07-11").dayOfYear(),moment("2015-07-12").dayOfYear(),moment("2015-07-18").dayOfYear(),moment("2015-07-19").dayOfYear(),moment("2015-07-25").dayOfYear(),moment("2015-07-26").dayOfYear(),moment("2015-08-01").dayOfYear(),moment("2015-08-02").dayOfYear(),moment("2015-08-08").dayOfYear(),moment("2015-08-09").dayOfYear(),moment("2015-08-15").dayOfYear(),moment("2015-08-16").dayOfYear(),moment("2015-08-22").dayOfYear(),moment("2015-08-23").dayOfYear(),moment("2015-08-29").dayOfYear(),moment("2015-08-30").dayOfYear(),moment("2015-09-05").dayOfYear(),moment("2015-09-06").dayOfYear(),moment("2015-09-12").dayOfYear(),moment("2015-09-13").dayOfYear(),moment("2015-09-19").dayOfYear(),moment("2015-09-20").dayOfYear(),moment("2015-09-26").dayOfYear(),moment("2015-09-27").dayOfYear(),moment("2015-10-01").dayOfYear(),moment("2015-10-02").dayOfYear(),moment("2015-10-03").dayOfYear(),moment("2015-10-04").dayOfYear(),moment("2015-10-05").dayOfYear(),moment("2015-10-06").dayOfYear(),moment("2015-10-07").dayOfYear(),moment("2015-10-10").dayOfYear(),moment("2015-10-11").dayOfYear(),moment("2015-10-17").dayOfYear(),moment("2015-10-18").dayOfYear(),moment("2015-10-24").dayOfYear(),moment("2015-10-25").dayOfYear(),moment("2015-10-31").dayOfYear(),moment("2015-11-01").dayOfYear(),moment("2015-11-07").dayOfYear(),moment("2015-11-08").dayOfYear(),moment("2015-11-14").dayOfYear(),moment("2015-11-15").dayOfYear(),moment("2015-11-21").dayOfYear(),moment("2015-11-22").dayOfYear(),moment("2015-11-28").dayOfYear(),moment("2015-11-29").dayOfYear(),moment("2015-12-05").dayOfYear(),moment("2015-12-06").dayOfYear(),moment("2015-12-12").dayOfYear(),moment("2015-12-13").dayOfYear(),moment("2015-12-19").dayOfYear(),moment("2015-12-20").dayOfYear(),moment("2015-12-26").dayOfYear(),moment("2015-12-27").dayOfYear()],b=function(){var b=moment().startOf("day");for((moment().hour()>14||14==moment().hour()&&moment().minute()>=30)&&(b=moment().endOf("day").add(1,"ms"));;){var c=b.dayOfYear();if(-1===a.indexOf(c))break;b=b.add(1,"day")}return b},c=function(b,c){--c;for(var d=b.clone();c;)d=d.add(1,"day"),-1===a.indexOf(d.dayOfYear())&&--c;return d.hour(14),d.minute(50),d.second(0),d},d=function(b){for(var c=moment(b).dayOfYear(),d=moment().dayOfYear(),e=0;d>=c;)-1===a.indexOf(d)&&++e,--d;return e};angular.module("commonApp",[]),angular.module("commonApp").value("gbToastr",toastr),angular.module("commonApp").factory("gbNotifier",["gbToastr",function(a){return{notify:function(b){a.success(b)},error:function(b){a.error(b)}}}]),angular.module("commonApp").filter("numTrunc",function(){return function(a){if(a){var b=a.toString(),c=b.search("\\.");c>-1&&(b=b.substr(c))}return b}}).filter("integerNum",function(){return function(a){var b=a,c=b.search("\\.");return c>-1&&(b=b.substr(0,c)),b}}).filter("displayOrderAmount",function(){return function(a,b){var c="";return(2===b||9===b)&&(c="-"),c+a}}).filter("displayMobile",function(){return function(a){return a?(a=a.toString(),a.substr(0,3)+"****"+a.substr(-4)):""}}).filter("displayEmail",function(){return function(a){if(a){var b=a.search("@");return a.substr(0,2)+"***"+a.substr(b)}return""}}).filter("displayIdentityID",function(){return function(a){return a?a.substr(0,4)+"**********"+a.substr(-4):""}}).filter("displayDate",function(){return function(a){return moment(a).format("YYYY-MM-DD HH:mm")}}).filter("displayCard",["BankNameList",function(a){return function(b){var c=b.cardID.toString().substr(12);return a[b.bankID].name+" **** **** **** "+c}}]).filter("orderStatus",function(){return function(a){switch(a){case 0:return"等待确认";case 1:return"交易成功";case 2:return"未支付";default:return"未支付"}}}).filter("displayOrderType",function(){return function(a){switch(a){case 1:return"充值";case 2:return"提现";case 3:return"盈利提取";case 4:return"股票盈利";case 5:return"保证金返还";case 6:return"追加配资保证金";case 7:return"配资延期";case 8:return"管理费返还";case 9:return"配资保证金";default:return"充值"}}}).filter("applyStatus",function(){return function(a){switch(a){case 1:return"待支付";case 2:return"操盘中";case 3:return"已结算";case 4:return"审核中";case 5:return"结算中";default:return"待支付"}}}).service("days",function(){this.startTime=b,this.endTime=c,this.tradeDaysTillNow=d});var e=[{name:"register_content",value:0,content:"验证码：CODE，用于注册，欢迎来到牛金网，为您提供专业贴心的配资服务。"},{name:"reset_pass_content",value:1,content:"验证码：CODE，用于密码重置，请勿泄露给他人！"},{name:"approve_apply_sms_content",value:2,content:"AMOUNT元资金已到账，股票账号ACCOUNT，登录密码PASSWORD，请勿向任何人泄露！"},{name:"close_apply_sms_content",value:3,content:"业务结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元）已完成，祝您投资愉快。"},{name:"pay_success_sms_content",value:4,content:"充值AMOUNT元已经到账，祝您投资愉快。"},{name:"warn_sms_content",value:5,content:"金额为AMOUNT元的操盘业务已经亏损到达警戒线WARN_AMOUNT元，请尽快追加保证金以维持仓位。"},{name:"sell_sms_content",value:6,content:"金额为AMOUNT元的操盘业务已经亏损到达平仓线SELL_AMOUNT元，系统已经将交易账户平仓，请登录牛金网查看相应信息。"},{name:"withdraw_content",value:7,content:"AMOUNT元资金提现已完成，请注意查收，当前牛金可用余额为BALANCE元。"}];angular.module("commonApp").constant("withdraw_sms_content","您于TIME在牛金网提现AMOUNT元，提现已完成，请注意查收，").constant("get_profit_sms_content","您的盈利提取申请已经处理，资金已划入您在牛金网的余额").constant("approve_apply_sms_content","您有一笔金额为AMOUNT元配资资金已到账，交易账号ACCOUNT，登录密码PASSWORD，您可以通过手机或电脑进行操盘，可以登录牛金网，在我的账户中查看相应账户信息，操盘账户是您操盘的唯一依据，请不要向任何人泄露！").constant("close_apply_sms_content","您在牛金网有一笔TOTAL_AMOUNT元的配资业务已经结算完毕，根据您的操盘收益，该笔配资实际结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元），祝您投资愉快。").constant("pay_success_sms_content","您于TIME在牛金网充值AMOUNT元，资金已经到账，感谢您对牛金网的支持，祝您投资愉快。").constant("warn_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达警戒线WARN_AMOUNT元，请尽快追加保证金以维持仓位，您可以登录牛金网进行操作，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sell_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达平仓线SELL_AMOUNT元，系统已经将交易账户平仓，请登录牛金网查看相应信息，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sms_macro",e).constant("service_charge",19.9).constant("warn_factor",.96).constant("sell_factor",.94),angular.module("commonApp").constant("BankNameList",[{name:"工商银行",img:"/images/yh/icbc.png",instCode:"ICBC",credit:!0,value:0},{name:"建设银行",img:"/images/yh/ccb.png",instCode:"CCB",credit:!0,value:1},{name:"农业银行",img:"/images/yh/abc.png",instCode:"ABC",credit:!0,value:2},{name:"中国银行",img:"/images/yh/boc.png",instCode:"BOC",credit:!0,value:3},{name:"招商银行",img:"/images/yh/cmb.png",instCode:"CMB",credit:!0,value:4},{name:"交通银行",img:"/images/yh/bcs.png",instCode:"COMM",credit:!0,value:5},{name:"邮政储蓄银行",img:"/images/yh/psbc.png",instCode:"PSBC",credit:!1,value:6},{name:"广发银行",img:"/images/yh/cgb.png",instCode:"GDB",credit:!0,value:7},{name:"光大银行",img:"/images/yh/ceb.png",instCode:"CEB",credit:!0,value:8},{name:"兴业银行",img:"/images/yh/cib.png",instCode:"CIB",credit:!0,value:9},{name:"北京银行",img:"/images/yh/bob.png",instCode:"BCCB",credit:!1,value:10},{name:"浦发银行",img:"/images/yh/spdb.png",instCode:"SPDB",credit:!0,value:11},{name:"民生银行",img:"/images/yh/cmbc.png",instCode:"CMBC",credit:!0,value:12},{name:"中信银行",img:"/images/yh/ecitic.png",instCode:"CITIC",credit:!0,value:13},{name:"华夏银行",img:"/images/yh/hx-2.png",instCode:"HXB",credit:!1,value:14},{name:"平安银行",img:"/images/yh/pa.png",instCode:"SZPAB",credit:!0,value:15},{name:"宁波银行",img:"/images/yh/nbcb.png",instCode:"NBCB",credit:!1,value:17},{name:"上海银行",img:"/images/yh/bos.png",instCode:"BOS",credit:!0,value:18}]),angular.module("commonApp").factory("njUser",["$resource",function(a){var b=a("/api/user/:id",{id:"@_id"});return b}]),angular.module("commonApp").factory("njApply",["$resource",function(a){var b=a("/api/user/:uid/applies/:serial_id",{uid:"@userID",serial_id:"@serialID"});return b}]),angular.module("commonApp").factory("njOrder",["$resource",function(a){var b=a("/api/user/:uid/orders/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("commonApp").factory("njCard",["$resource",function(a){var b=a("/api/cards/:uid",{userID:"@uid"});return b}]),angular.module("commonApp").factory("njCachedCards",["njCard",function(a){var b,c;return{setUID:function(a){c=a},query:function(){return b||(b=a.query({uid:c})),b}}}])}(),$(function(){function a(){e.offsetTop-c.scrollTop<=0?c.scrollTop-=d.offsetHeight:c.scrollTop++}$("#imgFocus").Carousel({ImgContentID:"ImgContent",ImgListClass:"selectLi",events:"click",AutoPlay:!0,speed:5e3,Styles:"opa",mobileSpeed:500});var b=80,c=document.getElementById("demo"),d=document.getElementById("demo1"),e=document.getElementById("demo2");e.innerHTML=d.innerHTML;var f=setInterval(a,b);c.onmouseover=function(){clearInterval(f)},c.onmouseout=function(){f=setInterval(a,b)}}),$(document).ready(function(){function a(a){$.aibei_mask({tip:"loading"}),$.aibei_showIframePayWindow(a,"window.aibeiNotify"),$.aibei_unmask(),$("#pay-confirm").modal({relatedTarget:this,onConfirm:function(){var a=$("#apply_id")[0]?$("#apply_id")[0].value:null;window.location.replace(a?"/thank_you_for_pay?apply_id="+a:"/thank_you_for_pay")},onCancel:function(){window.location.replace("/support_contact")}})}function b(b,c,d){var e=$("#trans_id")[0]?$("#trans_id")[0].value:null,f={id:b,uid:c,price:d};e?a(e):$.post("/user/iapp_pay",f,function(b){b.success?(console.log(b.transid),a(b.transid)):console.log("error")})}function c(a,c,e,f){var g={userID:a,dealType:1,amount:c,applySerialID:e,description:"股票配资"};$.ajax({url:"/api/user/"+a+"/orders?aid="+e,type:"POST",dataType:"json",data:g,success:function(e){1===f?d(e._id):b(e._id,a,c)},error:function(a){console.log(a)}})}function d(a){console.log("payByShengpay");var b=$("#Name")[0].value,c=$("#Version")[0].value,d=$("#Charset")[0].value,e=$("#MsgSender")[0].value;a&&($("#OrderNo")[0].value=a);var f=$("#OrderNo")[0].value,g=$("#OrderAmount")[0].value,h=$("#OrderTime")[0].value,i=$("#PageUrl")[0].value,j=$("#BackUrl")[0].value,k=$("#NotifyUrl")[0].value,l=returnCitySN.cip,m=$("#ProductName")[0].value,n=$("#SignType")[0].value,o="shengfutongSHENGFUTONGtest",p=b+c+d+e+f+g+h+i+j+k+m+l+n+o,q=SparkMD5.hash(p);q=q.toUpperCase(),$("#BuyerIp")[0].value=l,$("#SignMsg")[0].value=q,$("#shengPayForm")[0].submit()}moment.locale("zh-cn"),$("#verify-code-btn").click(function(){var a=$(this),b=$("#mobile")[0].value;if(!b||0!==b.search(/1[3|5|7|8|][0-9]{9}$/))return void $("#correct-mobile-alert").modal({});var c=0;a.addClass("am-disabled"),a[0].innerText="60秒后重试";var d=setInterval(function(){++c,a[0].innerText=60-c+"秒后重试",60===c&&(clearInterval(d),a[0].innerText="获取验证码",a.removeClass("am-disabled"))},1e3),e={mobile:b.trim()};$.get("/api/send_sms_verify_code",e,function(){})}),window.aibeiNotify=function(a){console.log("RetCode="+a.RetCode+":TransId="+a.TransId+":OrderStatus="+a.OrderStatus),0===a.RetCode&&(console.log("iapp pay complete"),console.log(0===a.OrderStatus?"iapp pay success":"iapp pay failed"))},$("#go-to-pay").on("click",function(a){a.preventDefault();var e=$("#user_id")[0].value,f=$("#pay_amount")[0].value,g=$("#apply_id")[0]?$("#apply_id")[0].value:null,h=$("#order_id")[0]?$("#order_id")[0].value:null,i=$("#pay-select")[0].value;return console.log("pay option:"+i),"option1"===i?void(h?d():c(e,f,g,1)):void(h?b(h,e,f):c(e,f,g,0))}),$("#go-to-use-balance").on("click",function(a){a.preventDefault();var b=$("#financingForm").serialize();$.post("/api/users/pay_by_balance",b,function(a){window.location.replace(a.success?"/thank_you_for_pay":"/failed_to_pay")})}),$("#close-apply").on("click",function(a){a.preventDefault(),$("#close-apply-prompt").modal({relatedTarget:this,onConfirm:function(){var a=$("#apply_serial_id")[0].value;$.post("/user/apply_close/"+a,{},function(a){console.log(a),window.location.replace(a.success?"/user/apply_close":"/support_contact")})},onCancel:function(){console.log("cancel")}})}),$("#get-profit").on("click",function(a){a.preventDefault();var b=$("#apply_serial_id")[0].value;window.location.assign("/apply/get_profit/"+b)});$("#add-deposit").on("click",function(a){a.preventDefault();var b=$("#apply_serial_id")[0].value;window.location.assign("/apply/add_deposit/"+b)}),$("#apply-postpone").on("click",function(a){a.preventDefault();var b=$("#apply_serial_id")[0].value;window.location.assign("/apply/apply_postpone/"+b)})}),function(a){a.fn.showTip=function(a,b){if("INPUT"===this[0].tagName){var c=this.siblings(".tip");switch(a.type){case"success":this.css("borderColor","#ddd"),c.html('<b class="correct"></b>').show();break;case"error":this.css("borderColor","red"),c.html('<b class="error"></b><b style="color:red;">'+a.msg+"</b>").show();break;case"clear":this.css("borderColor","#ddd"),c.hide();break;default:this.css("borderColor","#ddd"),c.text(a.msg).show()}b&&b()}},a("input").focus(function(){a(this).css("borderColor","#4d90fe")}).blur(function(){a(this).css("borderColor","#ddd")}),a.fn.countdown=function(b){var c;return function(){if(!c){var d=a(this),e=b,f={text:d.text(),color:d.css("color")};d.css({color:"#c5c5c5",cursor:"text"}).text("（"+e+"）重发验证码"),c=setInterval(function(){d.text("（"+(e-=1)+"）重发验证码"),-1===e&&(c=clearInterval(c),d.text(f.text).css({color:f.color,cursor:"auto"}))},1e3)}return this}}(60)}(jQuery),$(function(){var a=$("#phone"),b=$(".get-num-box"),c=!("oninput"in document.createElement("input"));a.bind(c?"keyup":"input",function(){for(var c=a.val().replace(/[^\d]/gm,"").split(""),d="",e=0;e<c.length;e++)d+=c[e],e+1==c.length||e+1!==3&&e+1!==7||(d+="");a.val(d);var f="";for(e=0;e<c.length;e++)13>e+1&&(f+="<span>"+c[e]+"</span>"),e+1==c.length||e+1!==3&&e+1!==7||(f+='<em class="space"></em>');b.html(f),d.length?b.show():b.hide()}),a.blur(function(){b.hide()})}),$(function(){$("#jq_tableBox tr:even td").css("background","#f5f5f5"),$("#jq_tableBox2 tr:even td").css("background","#f5f5f5"),$("#jq_tableBox3 tr:even td").css("background","#f5f5f5"),$("#tableMenu li").click(function(){var a=$(this).index();$(this).addClass("select").siblings().removeClass("select"),$("#tableMain>div").eq(a).show().siblings().hide()})}),angular.module("myApp").factory("gbIdentity",["$window",function(a){var b;return a.bootstrappedUserObject&&(b={},angular.extend(b,a.bootstrappedUserObject)),{currentUser:b}}]),function(){angular.module("applyApp",["commonApp"]),angular.module("applyApp").controller("ApplyController",["$http","$location","$window","days",function(a,b,c,d){function e(){h.summary.warnValue=h.summary.amount*i,h.summary.sellValue=h.summary.amount*j,h.summary.deposit=h.summary.amount*k;var a=h.summary.amount/1e4*l*h.summary.day;h.summary.charge=a,h.summary.total=h.summary.deposit+a,h.endTime=d.endTime(m,h.summary.day)}function f(){angular.forEach(h.amountList,function(a){a.select=!1})}function g(){h.summary.amount=h.otherAmount>=h.min_amount?Math.floor(h.otherAmount):h.otherAmount=h.min_amount,e()}var h=this;h.min_amount=10;var i=.96,j=.94,k=.1,l=19.9,m=d.startTime();h.agree=!0,h.showOtherAmount=!1,h.otherAmount=h.min_amount,h.summary={day:5,amount:5e4},h.endTime=d.endTime(m,h.summary.day),e(),h.amountList=[{name:"2000元",value:"2000"},{name:"1万",value:"10000"},{name:"3万",value:"30000"},{name:"5万",value:"50000",select:!0},{name:"10万",value:"100000"},{name:"30万",value:"300000"}],h.dayList=[{value:"2"},{value:"5",select:!0},{value:"8"},{value:"10"}],h.selectAmount=function(a){f(),h.showOtherAmount=!1,h.otherAmount=0,a.select=!0,h.summary.amount=a.value,e()},h.selectDay=function(){e()},h.toggleOtherAmount=function(){f(),h.showOtherAmount=!h.showOtherAmount,g()},h.finishOtherAmount=function(){g()},h.submitApply=function(){a.post("/apply",h.summary).then(function(a){a.data.success?c.location.href="/apply_confirm/"+a.data.apply_id:"not authenticate"===a.data.reason&&(c.location.href="/login")})}}])}(),function(){angular.module("mainApp",["ui.bootstrap","commonApp"]),angular.module("mainApp").controller("MainApplyController",["$http","$location","$window","days","$modal",function(a,b,c,d){function e(){i.summary.warnValue=i.summary.amount*j,i.summary.sellValue=i.summary.amount*k,i.summary.deposit=i.summary.amount*l;var a=i.summary.amount/1e4*m;i.summary.charge=a,i.summary.total=i.summary.deposit+a,i.endTime=d.endTime(n,i.summary.day)}function f(){angular.forEach(i.amountList,function(a){a.select=!1})}function g(){i.otherAmount>=i.min_amount?i.otherAmount<=i.max_amount?i.summary.amount=Math.floor(i.otherAmount):i.otherAmount=i.summary.amount=i.max_amount:i.summary.amount=0,e()}function h(){a.post("/apply",i.summary).success(function(a){c.location.href="/apply_confirm/"+a.apply_serial_id}).error(function(a,b){401===b?i.showLoginWindow=!0:console.log(a.error_msg)})}var i=this;i.min_amount=2e3,i.max_amount=3e5;var j=.96,k=.94,l=.1,m=19.9,n=d.startTime();i.agree=!0,i.showOtherAmount=!1,i.otherAmount,i.showLoginWindow=!1,i.summary={day:1,amount:2e3},i.endTime=d.endTime(n,i.summary.day),i.forbiddenStockList,e(),i.amountList=[{name:"2000元",value:"2000",select:!0},{name:"1万",value:"10000"},{name:"2万",value:"20000"},{name:"3万",value:"30000"},{name:"5万",value:"50000"},{name:"10万",value:"100000"},{name:"20万",value:"200000"},{name:"30万",value:"300000"}],i.selectAmount=function(a){f(),i.showOtherAmount=!1,a.select=!0,i.summary.amount=a.value,e()},i.toggleOtherAmount=function(){i.showOtherAmount=!i.showOtherAmount,i.showOtherAmount?g():i.selectAmount(i.amountList[0])},i.finishOtherAmount=function(){g()},i.submitApply=function(){if(!i.agree)return void alert("您必须同意《牛金操盘协议》");if(i.summary.amount<=0||i.summary.amount>3e5){var a=$("#invalid-value-modal");return void a.modal("open")}h()},i.showForbiddenStocks=function(){if(i.forbiddenStockList){var b=$("#forbidden-stock-modal");b.modal("open")}else a.get("/api/fetch_forbidden_stocks").success(function(a){i.forbiddenStockList=a;var b=$("#forbidden-stock-modal");b.modal({width:750,height:450})}).error(function(){})},i.login=function(){return i.mobile?i.password?void a.post("/api/login",{mobile:i.mobile,password:i.password}).success(function(){h()}).error(function(a){o("danger",a.error_msg)}):void o("danger","请输入密码，6到20位"):void o("danger","请输入有效的手机号")},i.alerts=[];var o=function(a,b){i.alerts=[],i.alerts.push({type:a,msg:b})};i.closeAlert=function(a){i.alerts.splice(a,1)}}]),angular.module("mainApp").controller("MainApplyConfirmController",["$http","$location","$window","days","service_charge",function(a,b,c,d,e){function f(){g.serviceFee=g.apply.amount/1e4*e*g.apply.period,g.totalAmount=g.apply.deposit+g.serviceFee,g.shouldPay=g.totalAmount-g.apply.userBalance,g.shouldPay<=0?(g.shouldPay=0,g.balancePay=!0):g.balancePay=!1}var g=this;g.apply={},c.bootstrappedApplyObject&&angular.extend(g.apply,c.bootstrappedApplyObject),g.validDays=[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],f(),g.selectDay=function(){f()},g.payForApply=function(){g.apply.shouldPay=g.shouldPay,g.apply.totalAmount=g.totalAmount,a.post("/apply_confirm",g.apply).success(function(b){if(0===g.shouldPay){var d={apply_serial_id:b.apply.serialID,order_id:b.order._id};a.post("/api/users/pay_by_balance",d).success(function(){c.location.assign("/apply/pay_success?serial_id="+b.apply.serialID+"&amount="+b.apply.amount)}).error(function(a){console.log("error:"+a.reason)})}else c.location.assign("/recharge2?order_id="+b.order._id)}).error(function(a){console.log("error:"+a.reason)})}}])}(),function(){angular.module("rechargeApp",["ngResource","ngRoute","ui.bootstrap","commonApp"]),angular.module("rechargeApp").controller("RechargeCtrl",["$scope","$window","$location","$http","njUser","njOrder","BankNameList",function(a,b,c,d,e,f,g){function h(a){var c=$("#Name")[0].value,d=$("#Version")[0].value,e=$("#Charset")[0].value,f=$("#MsgSender")[0].value,h=$("#OrderNo")[0].value=a._id,j=$("#OrderAmount")[0].value=a.amount.toFixed(2),k=$("#OrderTime")[0].value=moment().format("YYYYMMDDHHmmss"),l=$("#PayType")[0].value,m=$("#PayChannel")[0].value=i.useCredit?20:19,n=$("#InstCode")[0].value=g[i.payBank].instCode,o=$("#PageUrl")[0].value,p=$("#BackUrl")[0].value,q=$("#NotifyUrl")[0].value,r=$("#ProductName")[0].value,s=$("#BuyerIp")[0].value=b.returnCitySN.cip,t=$("#SignType")[0].value,u="JDJhJDA1JHpMRVc3UkJLR202R2hhNHZzZllMYi5",v=c+d+e+f+h+j+k+l+m+n+o+p+q+r+s+t+u,w=SparkMD5.hash(v);w=w.toUpperCase(),$("#SignMsg")[0].value=w,$("#shengPayForm")[0].submit()}var i=this;e.get({id:b.bootstrappedNiujinUserID},function(a){i.user=a;var c=b.location.search,d=c.search("pay_order="),e=null;if(d>-1){e=c.substr(d+10);var g=e.search("&");g>-1&&(e=e.substr(0,g))}e&&(i.pay_order_id=e,i.pay_order=f.get({uid:i.user._id,id:e},function(){i.pay_amount=Number(i.pay_order.amount.toFixed(2)),i.pay_order.applySerialID&&(i.pay_for_apply=!0)}))}),i.currentPayType=0,i.useCredit=!1,i.BankNameList=g,i.bankObj=i.BankNameList[0],i.payBank=0,i.alipayConfirm=!1,i.payTypes=[{name:"网银充值",value:0},{name:"支付宝转账",value:1},{name:"银行汇款",value:2}],i.alerts=[];var j=function(a,b){i.alerts=[],i.alerts.push({type:a,msg:b})};i.closeAlert=function(a){i.alerts.splice(a,1)},i.selectPayType=function(a){i.alerts=[],i.alipayConfirm=!1,i.currentPayType=a.value},i.selectPayBank=function(a){i.payBank=a.value},i.changeCardType=function(a){i.useCredit=a,i.BankNameList=i.useCredit?g.filter(function(a){return a.credit}):g},i.onlinePay=function(){if(!i.pay_amount||i.pay_amount<0)return void j("danger","请输入有效的充值金额");if(i.pay_amount=Number(i.pay_amount.toFixed(2)),!i.pay_amount)return void j("danger","最少充值1分钱");if(i.pay_order)h(i.pay_order);else{var a=new f({uid:i.user._id});a.userID=i.user._id,a.userMobile=i.user.mobile,a.dealType=1,a.amount=i.pay_amount,a.description="网站充值",a.$save(function(a){h(a)},function(){j("danger","服务暂时不可用，请稍后再试")})}},i.aliPay=function(){if(!i.pay_amount||i.pay_amount<0)return void j("danger","请输入有效的充值金额");if(!i.alipay_account)return void j("danger","请输入支付宝账户");if(!i.alipay_name)return void j("danger","请输入支付宝实名认证姓名");if(i.alipayConfirm=!0,i.pay_order)i.pay_order.payType=3,i.pay_order.otherInfo=i.alipay_account,i.pay_order.transID=i.alipay_name,i.pay_order.$save(function(){console.log("order update success")},function(){console.log("order update failed"),j("danger","服务暂时不可用，请稍后再试")});else{var a=new f({uid:i.user._id});a.userID=i.user._id,a.userMobile=i.user.mobile,a.dealType=1,a.amount=Number(i.pay_amount.toFixed(2)),a.description="支付宝转账",a.payType=3,a.status=2,a.otherInfo=i.alipay_account,a.transID=i.alipay_name,a.$save(function(){console.log("order create success")},function(){console.log("order create failed"),j("danger","服务暂时不可用，请稍后再试")})}},i.sendSMSBandInfo=function(){var a="户名：北京小牛普惠科技有限公司，账号：110912609510501，开户行：招商银行股份有限公司北京清华园支行";d.post("/api/send_sms",{sms_content:a}).success(function(){j("success","短信发送成功")}).error(function(){j("danger","短信发送失败，请稍后重试")})}}]),angular.module("rechargeApp").controller("RechargeCtrl2",["$scope","$window","$location","$http","njUser","njOrder","BankNameList",function(a,b,c,d,e,f,g){function h(a){j.user.lastPayBank=j.payBank,d.post("/api/user/"+j.user._id,j.user).success(function(a){j.user=a,console.log("lastPayBank updated")}).error(function(){console.log("lastPayBank update failed")});var c=$("#Name")[0].value,e=$("#Version")[0].value,f=$("#Charset")[0].value,h=$("#MsgSender")[0].value,i=$("#OrderNo")[0].value=a._id,k=$("#OrderAmount")[0].value=a.amount.toFixed(2),l=$("#OrderTime")[0].value=moment().format("YYYYMMDDHHmmss"),m=$("#PayType")[0].value,n=$("#PayChannel")[0].value=j.useCredit?20:19,o=$("#InstCode")[0].value=g[j.payBank].instCode,p=$("#PageUrl")[0].value,q=$("#BackUrl")[0].value,r=$("#NotifyUrl")[0].value,s=$("#ProductName")[0].value,t=$("#BuyerIp")[0].value=b.returnCitySN.cip,u=$("#SignType")[0].value,v="JDJhJDA1JHpMRVc3UkJLR202R2hhNHZzZllMYi5",w=c+e+f+h+i+k+l+m+n+o+p+q+r+s+t+u+v,x=SparkMD5.hash(w);x=x.toUpperCase(),$("#SignMsg")[0].value=x,$("#shengPayForm")[0].submit()}function i(){j.pay_amount=j.pay_order.amount,j.useBalance&&(j.pay_amount-=j.user.finance.balance)}var j=this;j.user=b.bootstrappedUserObject,j.pay_order=b.bootstrappedOrderObject,j.currentPayType=0,j.useCredit=!1,j.BankNameList=g,j.useBalance=!1,j.BankNameLists=[];for(var k=[],l=0;l<g.length;++l)4===k.length&&(j.BankNameLists.push(k),k=[]),k.push(g[l]);k.length>0&&j.BankNameLists.push(k),j.btnName="更换银行",j.showAlipayWindow=!1,j.showPayConfirm=!1,j.showBankTransWindow=!1,j.paying=!1,j.bankObj=j.BankNameList[0],j.payBank=-1,j.alipayConfirm=!1,j.user.lastPayBank>=0?j.payBank=j.user.lastPayBank:(j.btnName="收起",$(".jq_rec2_yhBox").toggleClass("rec2_yhBoxSelected"),$(".jq_rec2_yhkList").slideToggle(200)),j.payTypes=[{name:"网银充值",value:0},{name:"支付宝转账",value:1},{name:"银行汇款",value:2}],j.alerts=[],i();var m=function(a,b){j.alerts=[],j.alerts.push({type:a,msg:b})};j.closeAlert=function(a){j.alerts.splice(a,1)},j.selectPayType=function(a){j.alerts=[],j.alipayConfirm=!1,j.currentPayType=a,2===j.currentPayType&&(j.showBankTransWindow=!0),1===j.currentPayType&&(j.showAlipayWindow=!0)},j.selectPayBank=function(a){j.payBank=a.value,$(".jq_rec2_yhBox").toggleClass("rec2_yhBoxSelected"),$(".jq_rec2_yhkList").slideToggle(200),j.btnName="更换银行"},j.changeBtnName=function(){j.btnName="更换银行"===j.btnName?"收起":"更换银行"},j.changeCardType=function(a){j.useCredit=a,j.BankNameList=j.useCredit?g.filter(function(a){return a.credit}):g},j.sendSMSBankInfo=function(){var a="户名：北京小牛普惠科技有限公司，账号：110912609510501，开户行：招商银行股份有限公司北京清华园支行";d.post("/api/send_sms",{sms_content:a}).success(function(){m("success","短信发送成功")}).error(function(){m("danger","短信发送失败，请稍后重试")})},j.balanceChecked=function(){i()},j.gotoPay=function(){return-1===j.payBank?void m("danger","请先选择付款银行"):void(j.showPayConfirm=!0)},j.onlinePay=function(){j.pay_amount=Number(j.pay_amount.toFixed(2)),j.pay_order.amount=j.pay_amount,j.paying=!0,d.post("/api/user/"+j.user._id+"/orders/"+j.pay_order._id,j.pay_order).success(function(){console.log("order update success"),h(j.pay_order)}).error(function(){console.log("order update failed"),m("danger","服务暂时不可用，请稍后再试")})},j.closeOtherWindow=function(){j.showAlipayWindow=!1,j.showBankTransWindow=!1,j.alipayConfirm=!1,j.alerts=[]},j.aliPay=function(){return j.alipay_account?j.alipay_name?(j.alipayConfirm=!0,j.pay_amount=Number(j.pay_amount.toFixed(2)),j.pay_order.amount=j.pay_amount,j.pay_order.payType=3,j.pay_order.otherInfo=j.alipay_account,j.pay_order.transID=j.alipay_name,void d.post("/api/user/"+j.user._id+"/orders/"+j.pay_order._id,j.pay_order).success(function(){console.log("order update success")}).error(function(){console.log("order update failed"),m("danger","服务暂时不可用，请稍后再试")})):void m("danger","请输入支付宝实名认证姓名"):void m("danger","请输入支付宝账户")}}])}(),function(){angular.module("rechargeApp",["ngResource","ngRoute","ui.bootstrap","commonApp"]),angular.module("rechargeApp").controller("RechargeCtrl2",["$scope","$window","$location","$http","njUser","njOrder","BankNameList",function(a,b,c,d,e,f,g){function h(a){k.user.lastPayBank=k.payBank,d.post("/api/user/"+k.user._id,k.user).success(function(a){k.user=a,console.log("lastPayBank updated")}).error(function(){console.log("lastPayBank update failed")});var c=$("#Name")[0].value,e=$("#Version")[0].value,f=$("#Charset")[0].value,h=$("#MsgSender")[0].value,i=$("#OrderNo")[0].value=a._id,j=$("#OrderAmount")[0].value=a.amount.toFixed(2),l=$("#OrderTime")[0].value=moment().format("YYYYMMDDHHmmss"),m=$("#PayType")[0].value,n=$("#PayChannel")[0].value=k.useCredit?20:19,o=$("#InstCode")[0].value=g[k.payBank].instCode,p=$("#PageUrl")[0].value,q=$("#BackUrl")[0].value,r=$("#NotifyUrl")[0].value,s=$("#ProductName")[0].value,t=$("#BuyerIp")[0].value=b.returnCitySN.cip,u=$("#SignType")[0].value,v="JDJhJDA1JHpMRVc3UkJLR202R2hhNHZzZllMYi5",w=c+e+f+h+i+j+l+m+n+o+p+q+r+s+t+u+v,x=SparkMD5.hash(w);x=x.toUpperCase(),$("#SignMsg")[0].value=x,$("#shengPayForm")[0].submit()}function i(){return k.alipay_account?k.alipay_name?(k.alipayConfirm=!0,k.showNextBtn=!1,k.pay_amount=Number(k.pay_amount.toFixed(2)),k.pay_order.amount=k.pay_amount,k.pay_order.payType=3,k.pay_order.otherInfo=k.alipay_account,k.pay_order.transID=k.alipay_name,void d.post("/api/user/"+k.user._id+"/orders/"+k.pay_order._id,k.pay_order).success(function(){console.log("order update success")}).error(function(){console.log("order update failed"),n("danger","服务暂时不可用，请稍后再试")})):void n("danger","请输入支付宝实名认证姓名"):void n("danger","请输入支付宝账户")}function j(){k.pay_amount=k.pay_order.amount,k.useBalance&&(k.pay_amount-=k.user.finance.balance)}var k=this;k.user=b.bootstrappedUserObject,k.pay_order=b.bootstrappedOrderObject,k.currentPayType=0,k.useCredit=!1,k.BankNameList=g,k.useBalance=!1,k.BankNameLists=[];for(var l=[],m=0;m<g.length;++m)4===l.length&&(k.BankNameLists.push(l),l=[]),l.push(g[m]);l.length>0&&k.BankNameLists.push(l),k.showPayConfirm=!1,k.showNextBtn=!0,k.paying=!1,k.bankObj=k.BankNameList[0],k.payBank=-1,k.alipayConfirm=!1,k.user.lastPayBank>=0?k.payBank=k.user.lastPayBank:($(".jq_rec2_yhBox").toggleClass("rec2_yhBoxSelected"),$(".jq_rec2_yhkList").slideToggle(200)),k.payTypes=[{name:"网银充值",value:0},{name:"支付宝转账",value:1},{name:"银行汇款",value:2}],k.alerts=[],j();var n=function(a,b){k.alerts=[],k.alerts.push({type:a,msg:b})};k.closeAlert=function(a){k.alerts.splice(a,1)},k.selectPayType=function(a){k.alerts=[],k.alipayConfirm=!1,k.currentPayType=a,k.showNextBtn=2===k.currentPayType?!1:!0},k.selectPayBank=function(a){k.payBank=a.value},k.changeCardType=function(a){k.useCredit=a,k.BankNameList=k.useCredit?g.filter(function(a){return a.credit}):g},k.sendSMSBankInfo=function(){var a="户名：北京小牛普惠科技有限公司，账号：110912609510501，开户行：招商银行股份有限公司北京清华园支行";d.post("/api/send_sms",{sms_content:a}).success(function(){n("success","短信发送成功")}).error(function(){n("danger","短信发送失败，请稍后重试")})},k.balanceChecked=function(){console.log(k.useBalance),j()},k.gotoPay=function(){if(0===k.currentPayType){if(-1===k.payBank)return void n("danger","请先选择付款银行");k.showPayConfirm=!0}else 1===k.currentPayType&&i()},k.onlinePay=function(){k.pay_amount=Number(k.pay_amount.toFixed(2)),k.pay_order.amount=k.pay_amount,k.paying=!0,d.post("/api/user/"+k.user._id+"/orders/"+k.pay_order._id,k.pay_order).success(function(){console.log("order update success"),h(k.pay_order)
}).error(function(){console.log("order update failed"),n("danger","服务暂时不可用，请稍后再试")})}}])}(),function(){angular.module("registerApp",["ui.bootstrap","commonApp"]),angular.module("registerApp").controller("RegisterCtrl",["$http","$location","$window","$interval",function(a,b,c,d){var e=this;e.show_verify_window=!1,e.verify_code_error=!1,e.agree=!0,e.register=function(){if(!e.mobile)return void f("danger","请输入正确的手机号");if(!e.password)return void f("danger","请输入密码，长度6到20位");if(!e.confirm_password)return void f("danger","请再输一遍密码，长度6到20位");if(e.password!=e.confirm_password)return void f("danger","两次密码应该保持一致");if(!e.agree)return void f("danger","您必须同意牛金网用户协议");var b={mobile:e.mobile,password:e.password,confirm_password:e.confirm_password};a.post("/api_signup",b).success(function(){e.show_verify_window=!0,e.getVerifyCode()}).error(function(a){f("danger",a.error_msg)})},e.verifyCodeBtnText="获取验证码",e.verifyBtnDisabled=!1,e.getVerifyCode=function(b){if(!e.verifyBtnDisabled){e.verifyBtnDisabled=!0;var c=0;e.verifyCodeBtnText="60秒后重试";var f=d(function(){++c,e.verifyCodeBtnText=60-c+"秒后重试",60===c&&(d.cancel(f),e.verifyCodeBtnText="获取验证码",e.verifyBtnDisabled=!1)},1e3),g=b?2:1;a.get("/api/send_sms_verify_code?mobile="+e.mobile+"&type="+g).success(function(){}).error(function(){})}},e.confirmVerifyCode=function(){return e.verify_code?4!=e.verify_code.length?(e.signup_error_msg="验证码错误，请重新输入",void(e.verify_code_error=!0)):void a.post("/finish_signup",{mobile:e.mobile,verify_code:e.verify_code}).success(function(){c.location.replace("/welcome")}).error(function(a){e.signup_error_msg=a.error_msg,e.verify_code_error=!0}):(e.signup_error_msg="请输入验证码",void(e.verify_code_error=!0))},e.requestVerifyCode=function(){return e.mobile?void e.getVerifyCode(!0):void f("danger","请输入正确的手机号")},e.requestChangePassNext=function(){},e.requestChangePass=function(){return e.mobile?e.verify_code?e.password?e.confirm_password?e.password!==e.confirm_password?void f("danger","两次密码输入不一致"):void a.post("/forgot",{mobile:e.mobile,verify_code:e.verify_code,password:e.password,confirm_password:e.confirm_password}).success(function(){f("success","您的密码已经修改成功"),e.mobile="",e.verify_code="",e.password="",e.confirm_password=""}).error(function(a){f("danger",a.error_msg)}):void f("danger","请再输一遍密码，长度6到20位"):void f("danger","请输入密码，长度6到20位"):void f("danger","请输入验证码"):void f("danger","请输入正确的手机号")},e.login=function(){return e.mobile?e.password?void a.post("/api/login",{mobile:e.mobile,password:e.password}).success(function(a){c.location.replace(a.location?a.location:"/")}).error(function(a){f("danger",a.error_msg)}):void f("danger","请输入密码，长度6到20位"):void f("danger","请输入正确的手机号")},e.alerts=[];var f=function(a,b){e.alerts=[],e.alerts.push({type:a,msg:b})};if(e.closeAlert=function(a){e.alerts.splice(a,1)},$("#server_error_msg_login")[0]){var g=$("#server_error_msg_login")[0].value;1==g?f("danger","手机号码错误"):2==g?f("danger","请输入密码，长度6到20位"):3==g&&f("danger","该手机号码还未注册")}}])}(),angular.module("myApp").controller("UserApplyListController",["gbIdentity","$http","gbNotifier","$location","gbApply","$window","days",function(a,b,c,d,e,f,g){function h(){k.totalItems=l.length,k.currentPage=1,k.pageChanged()}function i(){m=e.query({uid:k.user._id},function(){angular.forEach(m,function(a){j(a)}),l=m,h()}),k.queryItems=[{name:"全部",value:0},{name:"待支付",value:1},{name:"当前操盘",value:2},{name:"已结算",value:3},{name:"审核中",value:4},{name:"结算中",value:5}]}function j(a){a.start_date=a.startTime?a.startTime:g.startTime(),a.end_date=a.endTime?a.endTime:g.endTime(a.start_date,a.period)}var k=this;k.user=a.currentUser;var l,m={};k.itemsPerPage=15,i(),k.queryItem=function(a){l=m.filter(function(b){return a.value?b.status===a.value:!0}),h()},k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=l.slice(a,b)},k.manageApply=function(a){1===a.status?f.location.assign("/apply_confirm/"+a.serialID):3===a.status?c.notify("该配资已经结算"):f.location.assign("/apply_detail/"+a.serialID)}}]),angular.module("myApp").controller("UserEmailController",["gbIdentity","$http","gbNotifier","$location",function(a,b,c){var d=this;d.user=a.currentUser,d.verifyEmail=function(){console.log("verify email"),b.post("/user/verify_email",{email:d.user.profile.email}).then(function(a){a.data.success?c.notify("验证邮件已成功发送"):c.error("邮件发送失败,请稍后再试")})}}]),angular.module("myApp").controller("UserIdentityController",["gbIdentity","$http","gbNotifier","$location",function(a,b,c,d){var e=this;e.user=a.currentUser,e.submitRequest=function(){b.post("/api/users/"+e.user._id,{identity:e.user.identity}).then(function(a){a.data.success?(c.notify("实名认证成功"),d.path("/security")):c.error("实名认证失败")})}}]),angular.module("myApp").controller("UserIndexController",["$location","$http",function(a,b){var c=this;c.gotoRoot=function(){window.location="/"},c.signout=function(){b.post("/logout",{logout:!0}).then(function(){window.location="/"})}}]),angular.module("myApp").controller("UserMainController",["gbIdentity",function(a){var b=this;b.user=a.currentUser,b.user_total_capital=(b.user.finance.balance+b.user.finance.deposit+b.user.finance.freeze_capital).toFixed(2),b.displayName=function(){return b.user.profile.name?b.user.profile.name:b.user.mobile},b.registerDate=function(){return moment(b.user.registerAt).format("ll")}}]),angular.module("myApp").controller("UserOrderController",["$window","gbIdentity","gbOrder",function(a,b,c){function d(){g=c.query({uid:h.user._id},function(){f=g,e()}),h.queryItems=[{name:"全部",value:0},{name:"充值",value:1},{name:"提现",value:2},{name:"盈利提取",value:3},{name:"股票盈利",value:4},{name:"保证金返还",value:5},{name:"追加配资保证金",value:6},{name:"配资延期",value:7},{name:"管理费返还",value:8}]}function e(){h.totalItems=f.length,h.currentPage=1,h.pageChanged()}var f,g,h=this;h.user=b.currentUser,h.itemsPerPage=15,h.queryItem=function(a){f=g.filter(function(b){return a.value?b.dealType===a.value:!0}),e()},h.pageChanged=function(){var a=(h.currentPage-1)*h.itemsPerPage,b=a+h.itemsPerPage;b>h.totalItems&&(b=h.totalItems),h.showingItems=f.slice(a,b)},h.manageOrder=function(b){b.status||1!==b.dealType||a.location.assign("/pay_confirm/"+b._id)},d()}]),angular.module("myApp").controller("UserPayController",["gbIdentity","$http","gbNotifier","$window","gbOrder",function(a,b,c,d,e){var f=this;f.user=a.currentUser,f.pay_option="option1",f.gotoPay=function(){if(!f.payAmount||f.payAmount<0)return void c.error("无效的充值金额");var a={userID:f.user._id,dealType:1,amount:f.payAmount,description:"网站充值"},b=new e(a);b.$save().then(function(){c.notify("订单提交成功");var a=1;"option2"===f.pay_option&&(a=2),d.location.assign("/pay_confirm/"+b._id+"?pay_option="+a)},function(a){c.error("订单提交失败 "+a.data.reason)})}}]),angular.module("myApp").controller("UserProfileController",["gbIdentity","gbNotifier","$http",function(a,b,c){var d=this;d.user=a.currentUser,d.updateUserProfile=function(){c.post("/api/users/"+d.user._id,{profile:d.user.profile}).then(function(a){a.data.success?b.notify("个人信息更新成功"):b.error("个人信息更新失败")})}}]),angular.module("myApp").controller("UserResetPasswordController",["gbIdentity","$http","gbNotifier","$location",function(a,b,c,d){var e=this;e.user=a.currentUser,e.submitRequest=function(){return e.new_pass!==e.confirm_pass?void c.error("两次输入的密码不同"):void b.post("/user/change_pass",{old_password:e.old_pass,password:e.new_pass,confirm_password:e.confirm_pass}).then(function(a){a.data.success?(c.notify("密码设置成功"),d.path("/security")):c.error("密码设置失败："+a.data.reason)})},e.changeFinancePass=function(){return e.new_finance_pass!==e.confirm_finance_pass?void c.error("两次输入的密码不同"):void b.post("/user/change_finance_pass",{password:e.login_pass,new_password:e.new_finance_pass,confirm_password:e.confirm_finance_pass}).then(function(a){a.data.success?(e.user.finance.password=e.new_finance_pass,c.notify("密码设置成功"),d.path("/security")):c.error(a.data.reason)})}}]),angular.module("myApp").controller("UserSecurityController",["gbIdentity",function(a){function b(){c.securityObjects=[{"class":"am-icon-user-secret am-icon-lg",title:"实名认证",status:c.user.identity.id?"已认证":"未认证",url:"/user#/identity",action:"去认证",show:c.user.identity.id?!1:!0},{"class":"am-icon-mobile am-icon-lg",title:"绑定手机",status:"已认证",url:"#",action:"修改",show:!1},{"class":"am-icon-envelope am-icon-lg",title:"验证邮箱",status:c.user.profile.email_verified?"已验证":"未验证",url:"/user#/verify_email",action:"去验证",show:c.user.profile.email_verified?!1:!0},{"class":"am-icon-key am-icon-lg",title:"登录密码",status:"已设置",url:"/user#/change_pass",action:"修改",show:!0},{"class":"am-icon-money am-icon-lg",title:"提现密码",status:c.user.finance.password?"已设置":"未设置",url:"/user#/change_finance_pass",action:c.user.finance.password?"修改":"设置",show:!0}]}var c=this;c.user=a.currentUser,b()}]),angular.module("myApp").controller("UserWithdrawController",["gbIdentity","gbNotifier","$location","gbCard","gbCachedCards","gbOrder","$http",function(a,b,c,d,e,f,g){var h=this;h.user=a.currentUser,h.cards=[],h.card={},h.card.userID=h.user._id,h.user.identity.name&&(h.card.userName=h.user.identity.name),e.setUID(h.user._id),h.cards=e.query(),h.selectCard=function(a){h.selected=a},h.isSelected=function(a){return h.selected===a},h.addCard=function(){var a=/^(\d{16}|\d{19})$/;if(!a.test(h.card.cardID))return void b.error("无效的银行卡号");var c=new d(h.card);c.$save().then(function(){b.notify("添加成功"),h.cards.push(h.card)},function(a){b.error("添加失败 "+a.data.reason)})},h.withdraw=function(){if(h.selected)if(h.amount<=0||h.amount>h.user.finance.balance)b.error("无效的提现金额："+h.amount);else{var a={userID:h.user._id,dealType:2,amount:h.amount,description:"余额提现",cardInfo:{bankName:h.selected.bankName,cardID:h.selected.cardID,userName:h.selected.userName}},c={order:a,password:h.password};g.post("/user/withdraw",c).success(function(){h.user.finance.freeze_capital+=a.amount,h.user.finance.balance-=a.amount,b.notify("您的提现申请已经提交,我们会尽快处理")}).error(function(a){b.error("提现申请提交失败 "+a.reason)})}else b.error("请选择要提现的银行卡")}}]),angular.module("myApp").factory("gbApply",["$resource",function(a){var b=a("/api/applies/:uid/apply/:aid",{userID:"@uid",applyID:"@aid"});return b}]),angular.module("myApp").factory("gbCard",["$resource",function(a){var b=a("/api/cards/:uid",{userID:"@uid"});return b}]),angular.module("myApp").factory("gbOrder",["$resource",function(a){var b=a("/api/user/:uid/orders/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("myApp").factory("gbCachedCards",["gbCard",function(a){var b,c;return{setUID:function(a){c=a},query:function(){return b||(b=a.query({uid:c})),b}}}]);