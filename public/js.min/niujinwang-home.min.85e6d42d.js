!function(){"use strict";angular.module("applyApp",["commonApp"]),angular.module("applyApp").controller("ApplyController",["$http","$location","$window","days",function(a,b,c,d){function e(){i.summary.warnValue=i.summary.amount*j,i.summary.sellValue=i.summary.amount*k,i.summary.deposit=i.summary.amount*l;var a=i.summary.amount/1e4*m*i.summary.day;i.summary.charge=a,i.summary.total=i.summary.deposit+a}function f(){angular.forEach(i.amountList,function(a){a.select=!1})}function g(){angular.forEach(i.dayList,function(a){a.select=!1})}function h(){i.summary.amount=i.otherAmount>=2e3?Math.floor(i.otherAmount):i.otherAmount=2e3,e()}var i=this,j=.93,k=.95,l=.1,m=18.8;i.agree=!0,i.showOtherAmount=!1,i.otherAmount=2e3,i.summary={day:5,amount:5e4},i.startTime=d.startTime(),e(),i.amountList=[{name:"2000元",value:"2000"},{name:"1万",value:"10000"},{name:"3万",value:"30000"},{name:"5万",value:"50000",select:!0},{name:"10万",value:"100000"},{name:"30万",value:"300000"}],i.dayList=[{value:"2"},{value:"5",select:!0},{value:"8"},{value:"10"}],i.selectAmount=function(a){f(),i.showOtherAmount=!1,i.otherAmount=0,a.select=!0,i.summary.amount=a.value,e()},i.selectDay=function(a){g(),a.select=!0,i.summary.day=a.value,e()},i.toggleOtherAmount=function(){f(),i.showOtherAmount=!i.showOtherAmount,h()},i.finishOtherAmount=function(){h()},i.submitApply=function(){a.post("/apply",i.summary).then(function(a){a.data.success?c.location.href="/apply_confirm/"+a.data.apply_id:"not authenticate"===a.data.reason&&(c.location.href="/login")})}}])}(),$(document).ready(function(){function a(a){$.aibei_mask({tip:"loading"}),$.aibei_showIframePayWindow(a,"window.aibeiNotify"),$.aibei_unmask(),$("#pay-confirm").modal({relatedTarget:this,onConfirm:function(){var a=$("#apply_id")[0]?$("#apply_id")[0].value:null;window.location.replace(a?"/thank_you_for_pay?apply_id="+a:"/thank_you_for_pay")},onCancel:function(){window.location.replace("/support_contact")}})}function b(b,c,d){var e=$("#trans_id")[0]?$("#trans_id")[0].value:null,f={id:b,uid:c,price:d};return window.niujin_data={},window.niujin_data.paying_order=f,e?void a(e):void $.post("/api/user_pay",f,function(b){b.success?(console.log(b.transid),a(b.transid)):console.log("error")})}function c(a,c,e,f){var g={userID:a,dealType:1,amount:c,description:"股票配资"};$.ajax({url:"/api/user/"+a+"/orders?aid="+e,type:"POST",dataType:"json",data:g,success:function(e){console.log(e._id),f?d(e._id):b(e._id,a,c)},error:function(a){console.log(a)}})}function d(a){console.log("payByShengpay");var b=$("#Name")[0].value,c=$("#Version")[0].value,d=$("#Charset")[0].value,e=$("#MsgSender")[0].value;a&&($("#OrderNo")[0].value=a);var f=$("#OrderNo")[0].value,g=$("#OrderAmount")[0].value,h=$("#OrderTime")[0].value,i=$("#PageUrl")[0].value,j=$("#BackUrl")[0].value,k=$("#NotifyUrl")[0].value,l=returnCitySN.cip,m=$("#ProductName")[0].value,n=$("#Ext1")[0].value,o=$("#SignType")[0].value,p="shengfutongSHENGFUTONGtest",q=b+c+d+e+f+g+h+i+j+k+m+l+n+o+p,r=SparkMD5.hash(q);r=r.toUpperCase(),console.log(r),$("#BuyerIp")[0].value=l,$("#SignMsg")[0].value=r,$("#shengPayForm")[0].submit()}moment.locale("zh-cn"),$(".verify-code-btn").click(function(){var a=$(this),b=$("#mobile")[0].value;if(!b||0!==b.search(/1[3|5|7|8|][0-9]{9}$/))return void $("#correct-mobile-alert").modal({});var c=0;a.addClass("am-disabled"),a[0].innerText="60秒后重试";var d=setInterval(function(){++c,a[0].innerText=60-c+"秒后重试",60===c&&(clearInterval(d),a[0].innerText="获取验证码",a.removeClass("am-disabled"))},1e3),e={mobile:b.trim()};$.get("/api/send_sms_verify_code",e,function(a){console.log(a)})}),window.aibeiNotify=function(a){if(console.log("RetCode="+a.RetCode+":TransId="+a.TransId+":OrderStatus="+a.OrderStatus),0===a.RetCode)if(console.log("pay complete"),0===a.OrderStatus){console.log("pay success");var b=$("#apply_id")[0]?$("#apply_id")[0].value:null;if(window.niujin_data&&window.niujin_data.paying_order){var c=window.niujin_data.paying_order.id,d=window.niujin_data.paying_order.price;window.niujin_data.paying_order=null,$.post("/api/users/pay_success/"+c,{pay_amount:d},function(a){a.success?b?$.post("/api/users/pay_by_balance",{pay_amount:d,apply_id:b},function(a){console.log(a.success?"success to pay for apply":"failed to pay for apply")}):console.log("pay success"):console.log("failed to update user balance after pay success")})}}else console.log("pay failed")},$("#go-to-pay").on("click",function(a){a.preventDefault();var e=$("#user_id")[0].value,f=$("#pay_amount")[0].value,g=$("#apply_id")[0]?$("#apply_id")[0].value:null,h=$("#order_id")[0]?$("#order_id")[0].value:null,i=$("#pay-select")[0].value;return console.log("pay option:"+i),"option1"===i?void(h?d():c(e,f,g,!0)):void(h?b(h,e,f):c(e,f,g))}),$("#go-to-use-balance").on("click",function(a){a.preventDefault();var b=$("form").serialize();$.post("/api/users/pay_by_balance",b,function(a){window.location.replace(a.success?"/thank_you_for_pay":"/failed_to_pay")})}),$("#close-apply").on("click",function(a){a.preventDefault(),$("#close-apply-prompt").modal({relatedTarget:this,onConfirm:function(){var a=$("#apply_serial_id")[0].value;$.post("/user/apply_close/"+a,{},function(a){console.log(a),window.location.replace(a.success?"/user/apply_close":"/support_contact")})},onCancel:function(){console.log("cancel")}})}),$("#get-profit").on("click",function(a){a.preventDefault()})}),function(){var a=[moment("2015-03-14").dayOfYear(),moment("2015-03-15").dayOfYear(),moment("2015-03-21").dayOfYear(),moment("2015-03-22").dayOfYear(),moment("2015-03-28").dayOfYear(),moment("2015-03-29").dayOfYear(),moment("2015-04-04").dayOfYear(),moment("2015-04-05").dayOfYear(),moment("2015-04-06").dayOfYear(),moment("2015-04-11").dayOfYear(),moment("2015-04-12").dayOfYear(),moment("2015-04-18").dayOfYear(),moment("2015-04-19").dayOfYear(),moment("2015-04-25").dayOfYear(),moment("2015-04-26").dayOfYear(),moment("2015-05-01").dayOfYear(),moment("2015-05-02").dayOfYear(),moment("2015-05-03").dayOfYear(),moment("2015-05-09").dayOfYear(),moment("2015-05-10").dayOfYear(),moment("2015-05-16").dayOfYear(),moment("2015-05-17").dayOfYear(),moment("2015-05-23").dayOfYear(),moment("2015-05-24").dayOfYear(),moment("2015-06-06").dayOfYear(),moment("2015-06-07").dayOfYear(),moment("2015-06-13").dayOfYear(),moment("2015-06-14").dayOfYear(),moment("2015-06-20").dayOfYear(),moment("2015-06-21").dayOfYear(),moment("2015-06-22").dayOfYear(),moment("2015-06-27").dayOfYear(),moment("2015-06-28").dayOfYear(),moment("2015-07-04").dayOfYear(),moment("2015-07-05").dayOfYear(),moment("2015-07-11").dayOfYear(),moment("2015-07-12").dayOfYear(),moment("2015-07-18").dayOfYear(),moment("2015-07-19").dayOfYear(),moment("2015-07-25").dayOfYear(),moment("2015-07-26").dayOfYear(),moment("2015-08-01").dayOfYear(),moment("2015-08-02").dayOfYear(),moment("2015-08-08").dayOfYear(),moment("2015-08-09").dayOfYear(),moment("2015-08-15").dayOfYear(),moment("2015-08-16").dayOfYear(),moment("2015-08-22").dayOfYear(),moment("2015-08-23").dayOfYear(),moment("2015-08-29").dayOfYear(),moment("2015-08-30").dayOfYear(),moment("2015-09-05").dayOfYear(),moment("2015-09-06").dayOfYear(),moment("2015-09-12").dayOfYear(),moment("2015-09-13").dayOfYear(),moment("2015-09-19").dayOfYear(),moment("2015-09-20").dayOfYear(),moment("2015-09-26").dayOfYear(),moment("2015-09-27").dayOfYear(),moment("2015-10-01").dayOfYear(),moment("2015-10-02").dayOfYear(),moment("2015-10-03").dayOfYear(),moment("2015-10-04").dayOfYear(),moment("2015-10-05").dayOfYear(),moment("2015-10-06").dayOfYear(),moment("2015-10-07").dayOfYear(),moment("2015-10-10").dayOfYear(),moment("2015-10-11").dayOfYear(),moment("2015-10-17").dayOfYear(),moment("2015-10-18").dayOfYear(),moment("2015-10-24").dayOfYear(),moment("2015-10-25").dayOfYear(),moment("2015-10-31").dayOfYear(),moment("2015-11-01").dayOfYear(),moment("2015-11-07").dayOfYear(),moment("2015-11-08").dayOfYear(),moment("2015-11-14").dayOfYear(),moment("2015-11-15").dayOfYear(),moment("2015-11-21").dayOfYear(),moment("2015-11-22").dayOfYear(),moment("2015-11-28").dayOfYear(),moment("2015-11-29").dayOfYear(),moment("2015-12-05").dayOfYear(),moment("2015-12-06").dayOfYear(),moment("2015-12-12").dayOfYear(),moment("2015-12-13").dayOfYear(),moment("2015-12-19").dayOfYear(),moment("2015-12-20").dayOfYear(),moment("2015-12-26").dayOfYear(),moment("2015-12-27").dayOfYear()],b=function(){var b=moment().startOf("day");for((moment().hour()>14||14==moment().hour()&&moment().minute()>=30)&&(b=moment().endOf("day").add(1,"ms"));;){var c=b.dayOfYear();if(-1===a.indexOf(c))break;b=b.add(1,"day")}return b},c=function(b,c){--c;for(var d=b.clone();c;)d=d.add(1,"day"),-1===a.indexOf(d.dayOfYear())&&--c;return d.hour(14),d.minute(54),d.second(59),d},d=function(b,c){var d=moment(b).dayOfYear(),e=0;for(--c;c;)-1===a.indexOf(d)&&--c,--d,++e;return e};angular.module("commonApp",[]),angular.module("commonApp").value("gbToastr",toastr),angular.module("commonApp").factory("gbNotifier",["gbToastr",function(a){return{notify:function(b){a.success(b)},error:function(b){a.error(b)}}}]),angular.module("commonApp").filter("displayDate",function(){return function(a){return moment(a).format("YYYY-MM-DD HH:mm")}}).filter("orderStatus",function(){return function(a){return a?"交易成功":"等待确认"}}).filter("displayOrderType",function(){return function(a){switch(a){case 1:return"充值";case 2:return"提现";case 3:return"盈利提取";case 4:return"股票盈利";case 5:return"保证金返还";default:return"充值"}}}).filter("applyStatus",function(){return function(a){switch(a){case 1:return"待支付";case 2:return"操盘中";case 3:return"已结算";case 4:return"审核中";case 5:return"结算中";default:return"待支付"}}}).service("days",function(){this.startTime=b,this.endTime=c,this.tradeDaysFromEndDay=d}),angular.module("commonApp").constant("withdraw_sms_content","您的提现申请已经处理，资金即将到账")}();