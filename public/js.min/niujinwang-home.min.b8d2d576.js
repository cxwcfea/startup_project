"use strict";angular.module("applyApp",[]),angular.module("applyApp").controller("ApplyController",["$http","$location","$window",function(a,b,c){function d(){h.summary.warnValue=h.summary.amount*i,h.summary.sellValue=h.summary.amount*j,h.summary.deposit=h.summary.amount*k;var a=h.summary.amount/1e4*l*h.summary.day;h.summary.charge=a,h.summary.total=h.summary.deposit+a}function e(){angular.forEach(h.amountList,function(a){a.select=!1})}function f(){angular.forEach(h.dayList,function(a){a.select=!1})}function g(){h.summary.amount=h.otherAmount>=2e3?Math.floor(h.otherAmount):h.otherAmount=2e3,d()}var h=this,i=.93,j=.95,k=.1,l=18.8;h.agree=!0,h.showOtherAmount=!1,h.otherAmount=2e3,h.summary={day:5,amount:5e4},d(),h.amountList=[{name:"2000元",value:"2000"},{name:"1万",value:"10000"},{name:"3万",value:"30000"},{name:"5万",value:"50000",select:!0},{name:"10万",value:"100000"},{name:"30万",value:"300000"}],h.dayList=[{value:"2"},{value:"5",select:!0},{value:"8"},{value:"10"}],h.selectAmount=function(a){e(),h.showOtherAmount=!1,h.otherAmount=0,a.select=!0,h.summary.amount=a.value,d()},h.selectDay=function(a){f(),a.select=!0,h.summary.day=a.value,d()},h.toggleOtherAmount=function(){e(),h.showOtherAmount=!h.showOtherAmount,g()},h.finishOtherAmount=function(){g()},h.submitApply=function(){a.post("/apply",h.summary).then(function(a){a.data.success?c.location.href="/apply_confirm/"+a.data.apply_id:"not authenticate"===a.data.reason&&(c.location.href="/login")})}}]),$(document).ready(function(){function a(){console.log("payComplete")}function b(){console.log("payCompleteForApply")}function c(c){0===c.RetCode&&console.log(1===c.OrderStatus?"pay success":"pay failed");{var d=$("#apply_id")[0]?$("#apply_id")[0].value:null;$("#order_id")[0]?$("#order_id")[0].value:null}d?b():a()}function d(a,b,d){var e={id:a,uid:b,price:d};$.post("/api/user_pay",e,function(a){a.success?(console.log(a.transid),$.aibei_mask({tip:"loading"}),$.aibei_showIframePayWindow(a.transid,c)):console.log("error")})}function e(a,b){var c={userID:a,dealType:"充值",amount:b,description:"股票配资"};$.ajax({url:"/api/user/"+a+"/orders",type:"POST",dataType:"json",data:c,success:function(c){console.log(c._id),d(c._id,a,b)},error:function(a){console.log(a)}})}moment.locale("zh-cn"),$(".verify-code-btn").click(function(){var a=$(this),b=$("#mobile")[0].value;if(!b||0!==b.search(/1[3|5|7|8|][0-9]{9}$/))return void $("#correct-mobile-alert").modal({});var c=0;a.addClass("am-disabled"),a[0].innerText="60秒后重试";var d=setInterval(function(){++c,a[0].innerText=60-c+"秒后重试",60===c&&(clearInterval(d),a[0].innerText="获取验证码",a.removeClass("am-disabled"))},1e3),e={mobile:b.trim()};$.get("/api/send_sms_verify_code",e,function(a){console.log(a)})}),$("#go-to-pay").on("click",function(a){a.preventDefault();var b=$("#user_id")[0].value,c=$("#pay_amount")[0].value,f=$("#apply_id")[0]?$("#apply_id")[0].value:null,g=$("#order_id")[0]?$("#order_id")[0].value:null;f?e(b,c):d(g,b,c)}),$("#go-to-use-balance").on("click",function(a){a.preventDefault();var b=$("form").serialize();$.post("/api/users/pay_by_balance",b,function(a){window.location.replace(a.success?"/thank_you_for_pay":"/failed_to_pay")})})});