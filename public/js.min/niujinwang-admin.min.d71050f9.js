"use strict";angular.module("adminApp",["ngResource","ngRoute","ui.bootstrap","commonApp"]),angular.module("adminApp").config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){c.defaults.headers.get||(c.defaults.headers.get={}),c.defaults.headers.get["Cache-Control"]="no-cache",c.defaults.headers.get.Pragma="no-cache",a.when("/users",{templateUrl:"/admin/user_list",controller:"AdminUserListCtrl as userVM"}).when("/applies/:uid",{templateUrl:"/admin/apply_list",controller:"AdminApplyListCtrl as applyVM"}).when("/orders/:uid",{templateUrl:"/admin/order_list",controller:"AdminOrderListCtrl as orderVM"}).when("/one_day_expire_apply",{templateUrl:"/admin/apply_expire_in_one_day",controller:"AdminExpireApplyCtrl as expireApplyVM"}).when("/closing_applies",{templateUrl:"/admin/closing_apply_list",controller:"AdminClosingApplyCtrl as closingApplyVM"}).when("/get_profit_orders",{templateUrl:"/admin/get_profit_order_list",controller:"AdminGetProfitOrderListCtrl as profitOrderListVM"}).when("/add_deposit_orders",{templateUrl:"/admin/add_deposit_order_list",controller:"AdminAddDepositOrderListCtrl as addDepositOrderListVM"}).when("/pending_applies",{templateUrl:"/admin/pending_apply_list",controller:"AdminPendingApplyCtrl as pendingApplyVM"}).when("/withdraw_orders",{templateUrl:"/admin/withdraw_order_list",controller:"AdminWithdrawOrderCtrl as withdrawOrderVM"}).when("/waiting_confirm_withdraw_order_list",{templateUrl:"/admin/waiting_confirm_withdraw_order_list",controller:"AdminWaitingCompleteWithdrawOrderCtrl as vm"}).when("/alipay_orders",{templateUrl:"/admin/alipay_order_list",controller:"AdminAlipayOrderListCtrl as alipayOrderListVM"}).when("/my_users",{templateUrl:"/admin/my_user_list",controller:"AdminMyUserListCtrl as myUserVM"}).when("/recharge_orders",{templateUrl:"/admin/recharge_order_list",controller:"AdminRechargeOrderListCtrl as rechargeOrderVM"}).when("/orders",{templateUrl:"/admin/orders",controller:"AdminOrderCtrl as orderVM"}).when("/orders_of_alipay",{templateUrl:"/admin/order_list_of_alipay",controller:"AdminOrderListOfAlipayCtrl as vm"}).when("/statistics",{templateUrl:"/admin/statistics"}).when("/sales_statistics",{templateUrl:"/admin/sales_statistics",controller:"AdminSalesStatisticsCtrl as vm"}).when("/user_page",{templateUrl:"/admin/user_page",controller:"AdminUserCtrl as vm"}).when("/return_fee_orders",{templateUrl:"/admin/return_fee_order_list",controller:"AdminReturnFeeOrderListCtrl as vm"}).when("/user_complain_list",{templateUrl:"/admin/user_complain_list",controller:"AdminUserComplainListCtrl as vm"}).when("/freeze_withdraw",{templateUrl:"/admin/freeze_withdraw_order_list",controller:"AdminFreezeWithdrawOrderListCtrl as vm"}).when("/contract_list",{templateUrl:"/admin/contract_list",controller:"AdminContractListCtrl"}).when("/loss_apply_list",{templateUrl:"/admin/loss_apply_list",controller:"AdminLossApplyListCtrl as vm"}).otherwise({redirectTo:"/users"})}]),angular.module("adminApp").controller("AdminAddDepositOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","adminApply",function(a,b,c,d,e,f,g){function h(){e.get("/admin/api/orders/add_deposit").success(function(a){l=a,j=l,i()})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.handleOrder=function(a){g.get({id:a.applySerialID,uid:a.userID},function(b){var c=d.open({templateUrl:"addDepositInfoModal.html",controller:"AddDepositInfoModalCtrl",resolve:{order:function(){return a},apply:function(){return b}}});c.result.then(function(){a.dealType=9,a.payType=7,e.post("/admin/api/orders/"+a._id,a).success(function(){f.notify("订单更新成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(){f.error("订单更新失败")})},function(){})})}}]),angular.module("adminApp").controller("AddDepositInfoModalCtrl",["$scope","$modalInstance","order","apply",function(a,b,c,d){a.userMobile=c.userMobile,a.homsAccount=d.account,a.amount=c.amount,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminAlipayOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","$filter","gbNotifier","adminApply",function(a,b,c,d,e,f,g){function h(){e.get("/admin/api/orders/alipay").success(function(a){l=f("orderBy")(a,"createdAt",!0),j=l,i()})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.handleOrder=function(a){var b=d.open({templateUrl:"alipayOrderModal.html",controller:"alipayOrderModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){return b.trans_id?void e.post("/admin/api/confirm_alipay_order/"+a._id,{trans_id:b.trans_id,account:b.account,name:b.name}).success(function(){g.notify("确认成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(a){console.log(a.error_msg),g.error("发生错误")}):void g.error("必须输入支付宝转账单号")},function(){})},k.deleteOrder=function(a){var b=d.open({templateUrl:"alipayOrderDeleteModal.html",controller:"alipayOrderDeleteModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/delete_alipay_order/"+a._id,{}).success(function(){g.notify("删除成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(a){console.log(a.error_msg),g.error("发生错误")})},function(){})}}]),angular.module("adminApp").controller("alipayOrderModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.amount=c.amount,a.account=c.otherInfo,a.name=c.transID,a.mobile=c.userMobile,a.ok=function(){b.close({trans_id:a.trans_id,account:a.account,name:a.name})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("alipayOrderDeleteModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.amount=c.amount,a.account=c.otherInfo,a.name=c.transID,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminApplyListCtrl",["$scope","$http","$location","$routeParams","$modal","adminApply","gbNotifier","days",function(a,b,c,d,e,f,g,h){function i(){m.totalItems=l.length,m.currentPage=1,m.pageChanged()}function j(a){n=f.query({uid:a},function(){angular.forEach(n,function(a){k(a)}),l=n,i()}),m.queryItems=[{name:"全部",value:0},{name:"待支付",value:1},{name:"当前操盘",value:2},{name:"已结算",value:3},{name:"审核中",value:4},{name:"结算中",value:5},{name:"排队中",value:9}]}function k(a){a.start_date=a.startTime?a.startTime:h.startTime(),a.end_date=a.endTime?a.endTime:h.endTime(a.start_date,a.period)}var l,m=this,n={};m.itemsPerPage=15,a.$on("$routeChangeSuccess",function(){if(0==c.path().indexOf("/applies/")){var a=d.uid;j(a)}}),m.pageChanged=function(){var a=(m.currentPage-1)*m.itemsPerPage,b=a+m.itemsPerPage;b>m.totalItems&&(b=m.totalItems),m.showingItems=l.slice(a,b)},m.queryItem=function(a){l=n.filter(function(b){return a.value?b.status===a.value:!0}),i()},m.manageApply=function(a){4===a.status||1===a.status?m.assignAccount(a):2===a.status&&m.sendSMS(a)},m.assignAccount=function(a){var c=e.open({templateUrl:"/views/assignAccountModal.html",controller:"AccountModalCtrl",resolve:{apply:function(){return a}}});c.result.then(function(c){var d={apply:a};c.account&&(d.homas={account:c.account,password:c.password}),b.post("/admin/api/apply/assign_account",d).success(function(b){console.log(b),g.notify("账户已分配"),a.status=b.apply.status,a.account=b.apply.account,a.pasword=b.apply.password}).error(function(a){g.error("分配失败:"+a.reason)})},function(){})},m.sendSMS=function(a){var c=e.open({templateUrl:"/views/smsModal.html",controller:"SMSModalCtrl",resolve:{serialID:function(){return a.serialID}}});c.result.then(function(c){m.sms_content=c;var d={user_mobile:a.userMobile,sms_content:m.sms_content};console.log(m.sms_content),b.post("/admin/api/send_sms",d).then(function(a){a.data.success?g.notify("短信已发送"):g.error("短信发送失败:"+a.data.reason)})},function(){})},m.moveApplyToPending=function(a){b.post("/admin/change_apply_to_pending",{serial_id:a.serialID}).success(function(){a.status=4,g.notify("更新成功")}).error(function(a){g.error(a.error_msg)})},m.updateApply=function(a){var b=e.open({templateUrl:"applyUpdateModal.html",controller:"UpdateApplyModalCtrl",resolve:{apply:function(){return a}}});b.result.then(function(b){if(console.log(b),b.dt){a.endTime=b.dt;var c=h.tradeDaysTillNow(a.startTime,a.period);a.endTime.setHours(14),a.endTime.setMinutes(54),a.endTime.setSeconds(59),a.startTime=moment(b.dt).subtract(c,"days").startOf("day").toDate()}a.status=Number(b.status),a.$save(function(a){g.notify("更新成功"),k(a)},function(){g.error("更新失败")})},function(){})},m.postponeOneDay=function(a){var c=e.open({templateUrl:"postponeModal.html",controller:"PostponeModalCtrl",resolve:{apply:function(){return a}}});c.result.then(function(){b.post("/admin/api/auto_postpone_apply",{serial_id:a.serialID}).success(function(){g.notify("延期成功")}).error(function(a){g.error("延期失败:"+a.error_msg)})},function(){})}}]),angular.module("adminApp").controller("AccountModalCtrl",["$scope","$modalInstance","apply",function(a,b,c){a.userMobile=c.userMobile,a.homs_password=c.userMobile.toString().substr(5),a.account_type="1",a.ok=function(){var c={account:a.homs_account,password:a.homs_password,type:a.account_type};b.close(c)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("SMSModalCtrl",["$scope","$modalInstance","serialID",function(a,b,c){a.sms_content="您好,您在牛金网的一笔配资【单号:"+c+"】,保证金已不足，请补足到保证金的80%。",a.ok=function(){b.close(a.sms_content)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("UpdateApplyModalCtrl",["$scope","$modalInstance","apply",function(a,b,c){a.data={},a.data.status=c.status,a.clear=function(){a.data.dt=null},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={startingDay:1},a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("PostponeModalCtrl",["$scope","$modalInstance","apply",function(a,b,c){a.apply=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminClosingApplyCtrl",["$scope","$http","$location","$modal","gbNotifier","days",function(a,b,c,d,e,f){function g(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}function h(){b.get("/admin/api/applies/closing").success(function(a){l=a,angular.forEach(l,function(a){k.totalAmount+=a.amount,i(a)}),j=l,g()})}function i(a){a.start_date=a.startTime?a.startTime:f.startTime(),a.end_date=a.endTime?a.endTime:f.endTime(a.start_date,a.period)}var j,k=this,l={};k.itemsPerPage=15,k.totalAmount=0,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.manageApply=function(a){var c=d.open({templateUrl:"applyClosingModal.html",controller:"ApplyClosingModalCtrl",resolve:{}});c.result.then(function(c){if(null===c.profit||void 0===c.profit)return void e.error("必须输入盈亏金额");var d={apply_serial_id:a.serialID,profit:c.profit};b.post("/admin/api/close_apply",d).success(function(){e.notify("结算成功")}).error(function(a){e.error("结算失败:"+a.error_msg)})},function(){})}}]),angular.module("adminApp").controller("ApplyClosingModalCtrl",["$scope","$modalInstance",function(a,b){a.data={},a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminContractListCtrl",["$scope","$http","$location","$modal","$resource","gbNotifier",function(a,b,c,d,e){function f(){a.totalItems=h.length,a.currentPage=1,a.pageChanged()}function g(){var b=e("/admin/api/contract_list",{});i=b.query({},function(){h=i,f()}),a.queryItems=[{name:"全部",value:0},{name:"进行中",value:1},{name:"已回款",value:2}]}var h,i={};a.itemsPerPage=15,g(),a.pageChanged=function(){var b=(a.currentPage-1)*a.itemsPerPage,c=b+a.itemsPerPage;c>a.totalItems&&(c=a.totalItems),a.showingItems=h.slice(b,c)},a.queryItem=function(a){h=i.filter(function(b){return a.value?b.status===a.value:!0}),f()},a.showBorrowerDetail=function(b){a.data.searchKey=b,c.path("user_page")},a.showInvestors=function(b){a.displayInvestors=!0,a.investorsForCurrentContract=b.investors}}]),angular.module("adminApp").controller("AdminExpireApplyCtrl",["$scope","$http","$location","$modal","gbNotifier","days",function(a,b,c,d,e,f){function g(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}function h(){b.get("/admin/api/applies/expire").success(function(a){l=a,angular.forEach(l,function(a){i(a)}),j=l,g()})}function i(a){a.start_date=a.startTime?a.startTime:f.startTime(),a.end_date=a.endTime?a.endTime:f.endTime(a.start_date,a.period)}var j,k=this,l={};k.itemsPerPage=15,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.manageApply=function(a){k.sendSMS(a)},k.forceCloseApply=function(a){var c=d.open({templateUrl:"forceCloseModal.html",controller:"forceCloseModalCtrl",resolve:{apply:function(){return a}}});c.result.then(function(){b.post("/user/apply_close/"+a.serialID,{}).success(function(){a.status=5,e.notify("已提交结算")}).error(function(){e.error("结算申请提交失败，请稍后重试")})},function(){})},k.sendSMS=function(a){var c=d.open({templateUrl:"/views/smsModal.html",controller:"SMSModalCtrl",resolve:{serialID:function(){return a.serialID}}});c.result.then(function(c){k.sms_content=c;var d={user_mobile:a.userMobile,sms_content:k.sms_content};console.log(k.sms_content),b.post("/admin/api/send_sms",d).then(function(a){a.data.success?e.notify("短信已发送"):e.error("短信发送失败:"+a.data.reason)})},function(){})},k.sendSellSMS=function(){e.notify("短信发送中..."),b.post("/admin/api/send_sell_sms",{}).success(function(){e.notify("短信已发送"),console.log("ok")}).error(function(){console.log("fail")})}}]),angular.module("adminApp").controller("forceCloseModalCtrl",["$scope","$modalInstance","apply",function(a,b,c){a.serial_id=c.serialID,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminFreezeWithdrawOrderListCtrl",["$scope","$location","$modal","$http","gbNotifier","gbUser",function(a,b,c,d,e,f){function g(){d.get("/admin/api/orders/freeze_withdraw_order").success(function(a){k=a,i=k,h()})}function h(){j.totalItems=i.length,j.currentPage=1,j.pageChanged()}var i,j=this,k={};j.itemsPerPage=15;var l=null;g(),j.pageChanged=function(){var a=(j.currentPage-1)*j.itemsPerPage,b=a+j.itemsPerPage;b>j.totalItems&&(b=j.totalItems),j.showingItems=i.slice(a,b)},j.removeOrder=function(a){d.post("/admin/api/reject_withdraw_order/"+a._id,{}).success(function(){e.notify("更新成功"),_.remove(k,function(b){return b._id===a._id}),i=k,h()}).error(function(a){e.error("更新失败:"+a.error_msg)})},j.handleOrder=function(a){a.status=0,d.post("/admin/api/orders/"+a._id,a).success(function(){e.notify("更新成功"),_.remove(k,function(b){return b._id===a._id}),i=k,h()}).error(function(a){e.error("更新失败:"+a.error_msg)})},j.orderHistory=function(a){f.get({id:a.userID},function(a){l=a}),d.get("/admin/api/fetch_user_order_history?user_id="+a.userID).success(function(b){var d=c.open({templateUrl:"orderHistoryModal.html",controller:"orderHistoryModalCtrl",size:"lg",resolve:{order:function(){return a},orders:function(){return b},user:function(){return l}}});d.result.then(function(){},function(){})}).error(function(a){console.log(a)})}}]),angular.module("adminApp").controller("AdminGetProfitOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","gbUser","adminApply",function(a,b,c,d,e,f,g,h){function i(){e.get("/admin/api/orders/get_profit").success(function(a){m=a,k=m,j()})}function j(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}var k,l=this,m={};l.itemsPerPage=15;var n=null;i(),l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.handleOrder=function(a){g.get({id:a.userID},function(a){n=a}),h.get({id:a.applySerialID,uid:a.userID},function(b){var c=d.open({templateUrl:"getProfitModal.html",controller:"GetProfitModalCtrl",resolve:{order:function(){return a},apply:function(){return b}}});c.result.then(function(){a.status=1,e.post("/admin/api/finish_get_profit?id="+a._id,{}).success(function(){n.finance.balance+=a.amount,_.remove(m,function(b){return b._id===a._id}),k=m,j(),f.notify("更新成功")}).error(function(a){f.error("更新失败:"+a.error_msg)})},function(){})})},l.deleteOrder=function(a){g.get({id:a.userID},function(a){n=a}),h.get({id:a.applySerialID,uid:a.userID},function(b){var c=d.open({templateUrl:"deleteProfitModal.html",controller:"DeleteProfitModalCtrl",resolve:{order:function(){return a},apply:function(){return b}}});c.result.then(function(c){return console.log(c),null===c||void 0===c?void f.error("请输入实际金额"):void e.post("/admin/api/delete_get_profit_order/"+a._id,{amount:c,account:b.account,order:a}).success(function(){_.remove(m,function(b){return b._id===a._id}),k=m,j(),f.notify("更新成功")}).error(function(a){f.error("更新失败:"+a.error_msg)})},function(){})})}}]),angular.module("adminApp").controller("GetProfitModalCtrl",["$scope","$modalInstance","order","apply","get_profit_sms_content",function(a,b,c,d){a.data={},a.applySerialID=c.applySerialID,a.amount=c.amount,a.account=d.account,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("DeleteProfitModalCtrl",["$scope","$modalInstance","order","apply","get_profit_sms_content",function(a,b,c,d){a.data={},a.applySerialID=c.applySerialID,a.amount=c.amount,a.account=d.account,a.ok=function(){b.close(a.actual_profit)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminLossApplyListCtrl",["$scope","$http","$location","$modal","$filter","gbNotifier","days",function(a,b,c,d,e,f){function g(){j.totalItems=i.length,j.currentPage=1,j.pageChanged()}function h(){b.get("/admin/api/apply/loss_list").success(function(a){k=a,k=e("orderBy")(k,"applyAt",!0),i=k,j.totalLoss=0,k.forEach(function(a){a.loss=a.deposit+a.profit,j.totalLoss+=a.loss}),g()})}var i,j=this,k={};j.itemsPerPage=15,h(),j.pageChanged=function(){var a=(j.currentPage-1)*j.itemsPerPage,b=a+j.itemsPerPage;b>j.totalItems&&(b=j.totalItems),j.showingItems=i.slice(a,b)},j.compensateLoss=function(a){var c=d.open({templateUrl:"views/compensateLossModal.html",controller:"UserCompensateLossModalCtrl2",resolve:{apply:function(){return a}}});c.result.then(function(c){!c.order_amount||c.order_amount<0?f.error("请输入有效的金额！"):c.apply_serial_id?(c.userMobile=a.userMobile,c.userID=a.userID,b.post("/admin/api/user_compensateLoss",c).success(function(){f.notify("追回成功！")}).error(function(a){f.error("追回失败:"+a.error_msg)})):f.error("请输入配资单号！")},function(){})},j.showRelatedList=function(a){b.get("/admin/api/order/apply_loss?serial_id="+a.serialID).success(function(a){j.relatedOrders=a,console.log(a)}).error(function(){})}}]),angular.module("adminApp").controller("UserCompensateLossModalCtrl2",["$scope","$modalInstance","apply",function(a,b,c){a.data={},a.userMobile=c.userMobile,a.data.apply_serial_id=c.serialID,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminMainCtrl",["$scope","$location","$http",function(a,b,c){var d=this;a.data={},d.gotoRoot=function(){window.location="/"},d.signout=function(){c.post("/logout",{logout:!0}).then(function(){window.location="/"})}}]),angular.module("adminApp").controller("AdminMyUserListCtrl",["$scope","$http","$modal","$location","gbUser","gbNotifier","$window","$filter",function(a,b,c,d,e,f,g,h){var i=this;i.users=e.query(function(){i.user=g.bootstrappedUserObject;var a=[];for(var b in i.users)i.users[b].manager==i.user.mobile&&a.push(i.users[b]);a=h("orderBy")(a,"registerAt",!0),i.users=a,i.showAllUsers()}),i.pageChanged=function(){var a=(i.currentPage-1)*i.itemsPerPage,b=a+i.itemsPerPage;b>i.totalItems&&(b=i.totalItems),i.currentUsers=i.users.slice(a,b)},i.registerDate=function(a){return moment(a).format("YYYY-MM-DD HH:mm")},i.showAllUsers=function(){i.totalItems=i.users.length,i.currentPage=1,i.itemsPerPage=15,i.pageChanged()},i.searchUser=function(){if(i.searchKey){i.currentUsers=[];for(var a in i.users)if(i.users[a].mobile==i.searchKey){i.currentUsers.push(i.users[a]);break}i.totalItems=i.currentUsers.length}},i.showApplies=function(b){a.data.selectedUser=b,d.path("/applies/"+b._id)},i.showOrders=function(b){a.data.selectedUser=b,d.path("/orders/"+b._id)},i.open=function(a){var d=c.open({templateUrl:"/views/smsModal.html",controller:"ModalInstanceCtrl",resolve:{}});d.result.then(function(c){i.sms_content=c;var d={user_mobile:a,sms_content:i.sms_content};b.post("/admin/api/send_sms",d).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})},function(){})},i.createOrder=function(a){var d=c.open({templateUrl:"views/createOrderModel.html",controller:"CreateOrderModalCtrl",resolve:{user:function(){return a}}});d.result.then(function(c){!c.order_amount||c.order_amount<0?f.error("请输入有效的订单金额！"):(c.userMobile=a.mobile,c.userID=a._id,b.post("/admin/api/create/order",c).success(function(){f.notify("订单创建成功！")}).error(function(a){f.notify("订单创建失败:"+a.error_msg)}))},function(){})},i.takeCustomer=function(a){b.post("/admin/api/take_customer",{userMobile:a.mobile}).success(function(b){a.manager=b.manager,f.notify("更新成功!")}).error(function(){f.error("更新失败!")})}}]),angular.module("adminApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","sms_macro",function(a,b,c){a.sms_content="您好，我是您在牛金网的专属客服XX。QQ:xxxxxx 微信:xxxxxx 如果您有任何问题都可以24小时随时咨询。牛金网感谢您对我们的支持，祝您股市大赚!",a.show_template=!0,a.macroChange=function(){switch(console.log(a.content_macro),a.content_macro){case"0":return void(a.sms_content=c[0].content);case"1":return void(a.sms_content=c[1].content);case"2":return void(a.sms_content=c[2].content);case"3":return void(a.sms_content=c[3].content);case"4":return void(a.sms_content=c[4].content);case"5":return void(a.sms_content=c[5].content);case"6":return void(a.sms_content=c[6].content);case"7":return void(a.sms_content=c[7].content)}},a.ok=function(){b.close(a.sms_content)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("UserUpdateModalCtrl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close(a.user)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("CreateOrderModalCtrl",["$scope","$modalInstance","user",function(a,b,c){a.userMobile=c.mobile,a.data={},a.data.order_type=1,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminOrderCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","adminApply","$filter",function(a,b,c,d,e,f,g,h){function i(){e.get("/admin/api/orders/all").success(function(a){m=h("orderBy")(a,"createdAt",!0),k=m.filter(function(a){return 2===a.dealType&&1===a.status}),j()})}function j(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}var k,l=this,m={};l.itemsPerPage=15,l.maxSize=5,l.queryItems=[{name:"全部",value:0},{name:"已确认的提现",value:1}],i(),l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.queryItem=function(a){k=1===a.value?m.filter(function(a){return 2===a.dealType&&1===a.status}):m,j()}}]),angular.module("adminApp").controller("AdminOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","adminOrder","gbNotifier","gbUser",function(a,b,c,d,e,f,g,h){function i(a){m=f.query({uid:a},function(){k=m.filter(function(a){return 1===a.status}),j()}),n||h.get({id:a},function(a){n=a}),l.queryItems=[{name:"全部",value:0},{name:"充值",value:1},{name:"提现",value:2},{name:"交易完成",value:7}]}function j(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}var k,l=this,m={};l.itemsPerPage=15;var n=a.data.selectedUser;a.$on("$routeChangeSuccess",function(){if(0==b.path().indexOf("/orders/")){var a=c.uid;i(a)}}),l.queryItem=function(a){k=m.filter(function(b){return a.value?7===a.value?1===b.status:b.dealType===a.value:!0}),j()},l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.handleOrder=function(a){if(2===a.dealType){var b=d.open({templateUrl:"/views/withdrawModal.html",controller:"WithdrawModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){if(!b.bank_trans_id)return void g.error("必须输入银行单号！");a.bankTransID=b.bank_trans_id,a.status=1,a.$save(function(){n.finance.freeze_capital-=a.amount,n.$save(function(){g.notify("更新成功")},function(a){g.error("更新失败:"+a.toString())})},function(a){g.error("更新失败:"+a.toString())});var c={user_mobile:n.mobile,sms_content:b.sms_content};e.post("/admin/api/send_sms",c).then(function(a){a.data.success?g.notify("短信已发送"):g.error("短信发送失败:"+a.data.reason)})},function(){})}},l.showDetail=function(a){alert(a.description)}}]),angular.module("adminApp").controller("WithdrawModalCtrl",["$scope","$modalInstance","order","sms_macro",function(a,b,c,d){a.data={},a.bank=c.cardInfo.bank,a.bankName=c.cardInfo.bankName,a.cardID=c.cardInfo.cardID,a.userName=c.cardInfo.userName,a.userMobile=c.userMobile,a.data.sms_content=d[7].content.replace("AMOUNT",c.amount),a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminOrderListOfAlipayCtrl",["$scope","$location","$resource","$modal","$http","adminOrder","gbNotifier","gbUser",function(a,b,c,d,e,f,g){function h(){var a=c("/admin/api/alipay_orders",{});l=a.query({},function(){j=l,i()})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.removeOrder=function(a){console.log("run"),e.post("/admin/api/delete_order_of_alipay/"+a._id,{}).success(function(){_.remove(l,function(b){return b._id===a._id}),j=l,i(),g.notify("删除成功")}).error(function(){g.notify("删除失败")})},k.handleOrder=function(a){if(2===a.dealType){var b=d.open({templateUrl:"/views/withdrawModal.html",controller:"WithdrawModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){if(!b.bank_trans_id)return void g.error("必须输入银行单号！");a.bankTransID=b.bank_trans_id,a.status=1,a.$save(function(){currentUser.finance.freeze_capital-=a.amount,currentUser.$save(function(){g.notify("更新成功")},function(a){g.error("更新失败:"+a.toString())})},function(a){g.error("更新失败:"+a.toString())});var c={user_mobile:currentUser.mobile,sms_content:b.sms_content};e.post("/admin/api/send_sms",c).then(function(a){a.data.success?g.notify("短信已发送"):g.error("短信发送失败:"+a.data.reason)})},function(){})}}}]),angular.module("adminApp").controller("WithdrawModalCtrl",["$scope","$modalInstance","order","sms_macro",function(a,b,c,d){a.data={},a.bank=c.cardInfo.bank,a.bankName=c.cardInfo.bankName,a.cardID=c.cardInfo.cardID,a.userName=c.cardInfo.userName,a.userMobile=c.userMobile,a.data.sms_content=d[7].content.replace("AMOUNT",c.amount),a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminPendingApplyCtrl",["$scope","$http","$location","$modal","$filter","gbNotifier","days",function(a,b,c,d,e,f,g){function h(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}function i(){b.get("/admin/api/applies/pending").success(function(a){m=a,m=e("orderBy")(m,"applyAt",!0),angular.forEach(m,function(a){j(a)}),k=m,h()})}function j(a){a.start_date=a.startTime?a.startTime:g.startTime(),a.end_date=a.endTime?a.endTime:g.endTime(a.start_date,a.period)}var k,l=this,m={};l.itemsPerPage=15,i(),l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.manageApply=function(a){var c=d.open({templateUrl:"/views/assignAccountModal.html",controller:"AccountModalCtrl",resolve:{apply:function(){return a}}});c.result.then(function(c){var d={apply:a};c.account&&(d.homas={account:c.account,password:c.password},d.accountType=Number(c.type)),b.post("/admin/api/apply/assign_account",d).success(function(b){console.log(b),f.notify("账户已分配"),a.status=b.apply.status,a.account=b.apply.account,a.pasword=b.apply.password}).error(function(a){f.error("分配失败:"+a.reason)})},function(){})},l.sendSMS=function(a){var c=d.open({templateUrl:"/views/smsModal.html",controller:"SMSModalCtrl2",resolve:{apply:function(){return a}}});c.result.then(function(c){l.sms_content=c;var d={user_mobile:a.userMobile,sms_content:l.sms_content};b.post("/admin/api/send_sms",d).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})},function(){})},l.cancelApply=function(a){var c=d.open({templateUrl:"cancelApplyModal.html",controller:"CancelApplyModalCtrl",resolve:{apply:function(){return a}}});c.result.then(function(){b.post("/admin/api/cancel_apply",{applySerialID:a.serialID}).success(function(){f.notify("取消成功"),_.remove(m,function(b){return b._id===a._id}),k=m,h()}).error(function(a){f.error("取消失败:"+a.error_msg)})},function(){})},l.showVip=function(a){return a?(k=m.filter(function(a){return!a.isTrial}),void h()):(k=m.filter(function(){return!0}),void h())}}]),angular.module("adminApp").controller("SMSModalCtrl2",["$scope","$modalInstance","apply","sms_macro",function(a,b,c,d){a.show_template=!1,a.sms_content=d[2].content.replace("AMOUNT",c.amount).replace("ACCOUNT",c.account).replace("PASSWORD",c.password),a.ok=function(){b.close(a.sms_content)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("CancelApplyModalCtrl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminRechargeOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","adminApply","$filter",function(a,b,c,d,e,f,g,h){function i(){e.get("/admin/api/orders/recharge").success(function(a){m=h("orderBy")(a,"createdAt",!0),k=m,j()})}function j(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}var k,l=this,m={};l.itemsPerPage=15,i(),l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.handleOrder=function(a){var b=d.open({templateUrl:"rechargeOrderModal.html",controller:"rechargeOrderModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/confirm_recharge_order/"+a._id,{}).success(function(){f.notify("确认成功"),_.remove(m,function(b){return b._id===a._id}),k=m,j()}).error(function(a){console.log(a.error_msg),f.error("发生错误")})},function(){})},l.deleteOrder=function(a){var b=d.open({templateUrl:"rechargeOrderDeleteModal.html",controller:"rechargeOrderDeleteModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/delete_recharge_order/"+a._id,{}).success(function(){f.notify("删除成功"),_.remove(m,function(b){return b._id===a._id}),k=m,j()}).error(function(a){console.log(a.error_msg),f.error("发生错误")})},function(){})}}]),angular.module("adminApp").controller("rechargeOrderModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.name=c.userMobile,a.trans_id=c.bankTransID,a.amount=c.amount,a.description=c.description,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("rechargeOrderDeleteModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.name=c.userMobile,a.trans_id=c.bankTransID,a.amount=c.amount,a.description=c.description,a.ok=function(){b.close()
},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminReturnFeeOrderListCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","adminApply","$filter",function(a,b,c,d,e,f,g,h){function i(){e.get("/admin/api/get_return_fee_orders").success(function(a){m=h("orderBy")(a,"createdAt",!0),k=m,j()})}function j(){l.totalItems=k.length,l.currentPage=1,l.pageChanged()}var k,l=this,m={};l.itemsPerPage=15,i(),l.pageChanged=function(){var a=(l.currentPage-1)*l.itemsPerPage,b=a+l.itemsPerPage;b>l.totalItems&&(b=l.totalItems),l.showingItems=k.slice(a,b)},l.handleOrder=function(a){var b=d.open({templateUrl:"returnFeeOrderModal.html",controller:"returnFeeOrderModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/confirm_return_fee_order/"+a._id,{}).success(function(){f.notify("确认成功"),_.remove(m,function(b){return b._id===a._id}),k=m,j()}).error(function(a){f.error("发生错误 "+a.error_msg)})},function(){})},l.deleteOrder=function(a){var b=d.open({templateUrl:"orderDeleteModal.html",controller:"orderDeleteModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/delete_recharge_order/"+a._id,{}).success(function(){f.notify("删除成功"),_.remove(m,function(b){return b._id===a._id}),k=m,j()}).error(function(a){console.log(a.error_msg),f.error("发生错误")})},function(){})}}]),angular.module("adminApp").controller("returnFeeOrderModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.name=c.userMobile,a.amount=c.amount,a.description=c.description,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("orderDeleteModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.name=c.userMobile,a.trans_id=c.bankTransID,a.amount=c.amount,a.description=c.description,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminSalesStatisticsCtrl",["$scope","$location","$http",function(a,b,c){var d=this;d.salesData={},c.get("/admin/api/sales_statistics").success(function(a){var b=moment().startOf("month").format("YYYYMM");d.salesData=a.filter(function(a){return a.transRate=a.newCustomers.length?a.newPayCustomers.length/a.newCustomers.length*100:0,a.transRate=a.transRate.toFixed(2),a.month===b})})}]),angular.module("adminApp").controller("AdminUserComplainListCtrl",["$scope","$location","$modal","$http","$filter","adminOrder","gbNotifier",function(a,b,c,d,e,f,g){function h(){d.get("/admin/api/user_complain_list").success(function(a){l=e("orderBy")(a,"createdAt",!0),j=l,i()}).error(function(){g.error("获取信息失败")})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15,h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.searchUser=function(c){a.data.searchKey=c,b.path("/user_page")},k.removeItem=function(a){d.post("/admin/api/delete_user_complain",{id:a._id}).success(function(){_.remove(l,function(b){return b._id===a._id}),j=l,i(),g.notify("删除成功")}).error(function(a){g.notify("删除失败 "+a.error_msg)})}}]),angular.module("adminApp").controller("AdminUserCtrl",["$scope","$http","$modal","$location","gbUser","gbNotifier","$filter",function(a,b,c,d,e,f){var g=this;a.data.searchKey&&(g.searchKey=a.data.searchKey,b.get("/admin/api/user?mobile="+g.searchKey).success(function(a){g.user=a}).error(function(a){f.error("失败:"+a.error_msg)})),g.registerDate=function(a){return moment(a).format("YYYY-MM-DD HH:mm")},g.searchUser=function(){g.searchKey&&(a.data.searchKey=g.searchKey,b.get("/admin/api/user?mobile="+g.searchKey).success(function(a){g.user=a}).error(function(a){f.error("失败:"+a.error_msg)}))},g.showApplies=function(){a.data.selectedUser=g.user,d.path("/applies/"+g.user._id)},g.showOrders=function(){a.data.selectedUser=g.user,d.path("/orders/"+g.user._id)},g.open=function(){var a=c.open({templateUrl:"/views/smsModal.html",controller:"ModalInstanceCtrl",resolve:{}});a.result.then(function(a){g.sms_content=a;var c={user_mobile:g.user.mobile,sms_content:g.sms_content};b.post("/admin/api/send_sms",c).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})},function(){})},g.createOrder=function(){var a=c.open({templateUrl:"views/createOrderModel.html",controller:"CreateOrderModalCtrl",resolve:{user:function(){return g.user}}});a.result.then(function(a){!a.order_amount||a.order_amount<0?f.error("请输入有效的订单金额！"):(a.userMobile=g.user.mobile,a.userID=g.user._id,b.post("/admin/api/create/order",a).success(function(){f.notify("订单创建成功！")}).error(function(a){f.error("订单创建失败:"+a.error_msg)}))},function(){})},g.takeCustomer=function(a){b.post("/admin/api/take_customer",{userMobile:g.user.mobile}).success(function(b){a.manager=b.manager,f.notify("更新成功!")}).error(function(a){f.error("更新失败! "+a.error_msg)})},g.changeRefer=function(){var a=c.open({templateUrl:"views/changeReferModal.html",controller:"UserChangeReferModalCtrl",resolve:{}});a.result.then(function(a){a?b.get("/admin/api/user/change_user_refer?mobile="+g.user.mobile+"&refer="+a).success(function(){f.notify("修改成功！"),g.user.refer=a}).error(function(a){f.error("修改失败:"+a.error_msg)}):f.error("必须输入推荐码！")},function(){})},g.compensateLoss=function(){var a=c.open({templateUrl:"views/compensateLossModal.html",controller:"UserCompensateLossModalCtrl",resolve:{user:function(){return g.user}}});a.result.then(function(a){!a.order_amount||a.order_amount<0?f.error("请输入有效的金额！"):a.apply_serial_id?(a.userMobile=g.user.mobile,a.userID=g.user._id,b.post("/admin/api/user_compensateLoss",a).success(function(){f.notify("追回成功！"),g.user.finance.balance-=a.order_amount}).error(function(a){f.error("追回失败:"+a.error_msg)})):f.error("请输入配资单号！")},function(){})}}]),angular.module("adminApp").controller("UserChangeReferModalCtrl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close(a.refer)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("UserCompensateLossModalCtrl",["$scope","$modalInstance","user",function(a,b,c){a.data={},a.userMobile=c.mobile,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminUserListCtrl",["$scope","$http","$modal","$location","gbNotifier","$filter","$resource",function(a,b,c,d,e,f,g){var h=this;h.maxSize=5,a.data.searchKey&&(h.searchKey=a.data.searchKey);var i=g("/admin/api/new_users",{});h.users=i.query(function(){h.users=f("orderBy")(h.users,"registerAt",!0);var a=h.users.filter(function(a){return a.finance.history_deposit>100});h.num_of_pay_user=a.length;var b=h.users.filter(function(a){return null!=a.freeApply&&void 0!=a.freeApply});h.num_of_free_user=b.length,h.users.length>0?(h.pay_rate=(h.num_of_pay_user/h.users.length*100).toFixed(0),h.free_rate=(h.num_of_free_user/h.users.length*100).toFixed(0)):(h.pay_rate=0,h.free_rate=0),h.showAllUsers()}),b.get("/admin/api/user_rate_data").success(function(a){h.rateData=a}).error(function(){console.log("error when get user rate data")}),h.pageChanged=function(){var a=(h.currentPage-1)*h.itemsPerPage,b=a+h.itemsPerPage;b>h.totalItems&&(b=h.totalItems),h.currentUsers=h.users.slice(a,b)},h.registerDate=function(a){return moment(a).format("YYYY-MM-DD HH:mm")},h.showAllUsers=function(){h.totalItems=h.users.length,h.currentPage=1,h.itemsPerPage=15,h.pageChanged()},h.searchUser=function(){if(h.searchKey){a.data.searchKey=h.searchKey,h.currentUsers=[];for(var b in h.users)if(h.users[b].mobile==h.searchKey){h.currentUsers.push(h.users[b]);break}h.totalItems=h.currentUsers.length}},h.showApplies=function(b){a.data.selectedUser=b,d.path("/applies/"+b._id)},h.showOrders=function(b){a.data.selectedUser=b,d.path("/orders/"+b._id)},h.open=function(a){var d=c.open({templateUrl:"/views/smsModal.html",controller:"ModalInstanceCtrl",resolve:{}});d.result.then(function(c){h.sms_content=c;var d={user_mobile:a,sms_content:h.sms_content};b.post("/admin/api/send_sms",d).then(function(a){a.data.success?e.notify("短信已发送"):e.error("短信发送失败:"+a.data.reason)})},function(){})},h.createOrder=function(a){var d=c.open({templateUrl:"views/createOrderModel.html",controller:"CreateOrderModalCtrl",resolve:{user:function(){return a}}});d.result.then(function(c){!c.order_amount||c.order_amount<0?e.error("请输入有效的订单金额！"):(c.userMobile=a.mobile,c.userID=a._id,b.post("/admin/api/create/order",c).success(function(){e.notify("订单创建成功！")}).error(function(a){e.error("订单创建失败:"+a.error_msg)}))},function(){})},h.takeCustomer=function(a){b.post("/admin/api/take_customer",{userMobile:a.mobile}).success(function(b){a.manager=b.manager,e.notify("更新成功!")}).error(function(a){e.error("更新失败! "+a.error_msg)})}}]),angular.module("adminApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","sms_macro",function(a,b,c){a.sms_content="您好，我是您在牛金网的专属客服XX。QQ:xxxxxx 微信:xxxxxx 如果您有任何问题都可以24小时随时咨询。牛金网感谢您对我们的支持，祝您股市大赚!",a.show_template=!0,a.macroChange=function(){switch(console.log(a.content_macro),a.content_macro){case"0":return void(a.sms_content=c[0].content);case"1":return void(a.sms_content=c[1].content);case"2":return void(a.sms_content=c[2].content);case"3":return void(a.sms_content=c[3].content);case"4":return void(a.sms_content=c[4].content);case"5":return void(a.sms_content=c[5].content);case"6":return void(a.sms_content=c[6].content);case"7":return void(a.sms_content=c[7].content)}},a.ok=function(){b.close(a.sms_content)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("UserUpdateModalCtrl",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close(a.user)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("CreateOrderModalCtrl",["$scope","$modalInstance","user",function(a,b,c){a.userMobile=c.mobile,a.data={},a.data.order_type=1,a.data.pay_type=0,a.ok=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("AdminWaitingCompleteWithdrawOrderCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","gbUser",function(a,b,c,d,e,f,g){function h(){e.get("/admin/api/orders/waiting_complete_withdraw").success(function(a){l=a,j=l,i()})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15;var m=null;h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.startToPay=function(){for(;l.length;){var a=l.pop();e.post("/admin/api/handle_with_draw_order",a).success(function(){f.notify("成功")}).error(function(){f.error("失败")})}j=l,i()},k.startToCheck=function(){for(;l.length;){var a=l.pop();e.get("/admin/api/check_withdraw_order_status?trans_id="+a.otherInfo).success(function(){f.notify("成功")}).error(function(){f.error("失败")})}j=l,i()},k.removeOrder=function(a){e.post("/admin/api/reject_withdraw_order/"+a._id,{}).success(function(){f.notify("更新成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(a){f.error("更新失败:"+a.error_msg)})},k.handleOrder=function(a){m=null,g.get({id:a.userID},function(a){m=a});var b=d.open({templateUrl:"/views/withdrawModal.html",controller:"WithdrawModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){if(!b.bank_trans_id)return void f.error("必须输入银行单号！");if(!m)return void f.error("数据还未准备好，请稍后再试！");var c={uid:a.userID,bank_trans_id:b.bank_trans_id};e.post("/admin/api/user/withdraw/"+a._id,c).success(function(c){a=c,f.notify("更新成功"),m.finance.freeze_capital-=a.amount;var c={user_mobile:m.mobile,sms_content:b.sms_content.replace("BALANCE",m.finance.balance.toFixed(2))};e.post("/admin/api/send_sms",c).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})}).error(function(a){f.error("更新失败:"+a.error_msg)})},function(){})},k.orderHistory=function(a){g.get({id:a.userID},function(a){m=a}),e.get("/admin/api/fetch_user_order_history?user_id="+a.userID).success(function(b){var c=d.open({templateUrl:"orderHistoryModal.html",controller:"orderHistoryModalCtrl",size:"lg",resolve:{order:function(){return a},orders:function(){return b},user:function(){return m}}});c.result.then(function(){},function(){})}).error(function(a){console.log(a)})},k.zhongxinPay=function(a){e.post("/admin/api/handle_with_draw_order",a).success(function(){f.notify("成功")}).error(function(a){f.error("失败 "+a.error_msg)})},k.zhongxinCheck=function(a){e.get("/admin/api/check_withdraw_order_status?trans_id="+a.otherInfo).success(function(){f.notify("成功")}).error(function(){f.error("失败")})},k.reGenerateID=function(a){e.get("/admin/api/regenerate_order_pay_id?id="+a._id).success(function(b){f.notify("成功"),a.otherInfo=b.newID}).error(function(){f.error("失败")})}}]),angular.module("adminApp").controller("AdminWithdrawOrderCtrl",["$scope","$location","$routeParams","$modal","$http","gbNotifier","gbUser",function(a,b,c,d,e,f,g){function h(){e.get("/admin/api/orders/withdraw").success(function(a){l=a,j=l,i()})}function i(){k.totalItems=j.length,k.currentPage=1,k.pageChanged()}var j,k=this,l={};k.itemsPerPage=15;var m=null;h(),k.pageChanged=function(){var a=(k.currentPage-1)*k.itemsPerPage,b=a+k.itemsPerPage;b>k.totalItems&&(b=k.totalItems),k.showingItems=j.slice(a,b)},k.removeOrder=function(a){var b=d.open({templateUrl:"withdrawOrderDeleteModal.html",controller:"withdrawOrderDeleteModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(){e.post("/admin/api/delete_withdraw_order/"+a._id,{}).success(function(){f.notify("删除成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(a){console.log(a.error_msg),f.error("发生错误")})},function(){})},k.handleOrder=function(a){m=null,g.get({id:a.userID},function(a){m=a});var b=d.open({templateUrl:"/views/withdrawModal.html",controller:"WithdrawModalCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){if(!b.bank_trans_id)return void f.error("必须输入银行单号！");if(!m)return void f.error("数据还未准备好，请稍后再试！");var c={uid:a.userID,bank_trans_id:b.bank_trans_id};e.post("/admin/api/user/withdraw/"+a._id,c).success(function(c){a=c,f.notify("更新成功"),m.finance.freeze_capital-=a.amount;var c={user_mobile:m.mobile,sms_content:b.sms_content.replace("BALANCE",m.finance.balance.toFixed(2))};e.post("/admin/api/send_sms",c).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})}).error(function(a){f.error("更新失败:"+a.error_msg)})},function(){})},k.orderHistory=function(a){g.get({id:a.userID},function(a){m=a}),e.get("/admin/api/fetch_user_order_history?user_id="+a.userID).success(function(b){var c=d.open({templateUrl:"orderHistoryModal.html",controller:"orderHistoryModalCtrl",size:"lg",resolve:{order:function(){return a},orders:function(){return b},user:function(){return m}}});c.result.then(function(){},function(){})}).error(function(a){console.log(a)})},k.approveOrder=function(a){console.log("approve order"),e.post("/admin/api/approve_with_draw_order/"+a._id,{}).success(function(){f.notify("更新成功"),_.remove(l,function(b){return b._id===a._id}),j=l,i()}).error(function(a){f.error("更新失败:"+a.error_msg)})},k.sendSMS=function(a){var b=d.open({templateUrl:"/views/smsModal.html",controller:"withdrawSMSCtrl",resolve:{order:function(){return a}}});b.result.then(function(b){k.sms_content=b;var c={user_mobile:a.userMobile,sms_content:k.sms_content};e.post("/admin/api/send_sms",c).then(function(a){a.data.success?f.notify("短信已发送"):f.error("短信发送失败:"+a.data.reason)})},function(){})}}]),angular.module("adminApp").controller("withdrawSMSCtrl",["$scope","$modalInstance","order",function(a,b){a.ok=function(){b.close(a.sms_content)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("withdrawOrderDeleteModalCtrl",["$scope","$modalInstance","order",function(a,b,c){a.amount=c.amount,a.bank=c.cardInfo.bank,a.bankName=c.cardInfo.bankName,a.cardID=c.cardInfo.cardID,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").controller("orderHistoryModalCtrl",["$scope","$modalInstance","order","orders","user",function(a,b,c,d,e){a.userMobile=c.userMobile,a.amount=c.amount,e&&(a.deposit=e.finance.deposit),a.rechargeOrders=d.filter(function(a){return 1===a.dealType}),a.withdrawOrders=d.filter(function(a){return 2===a.dealType}),a.profitOrders=d.filter(function(a){return 4===a.dealType}),a.profitAmount=0,a.profitOrders.map(function(b){a.profitAmount+=b.amount}),a.rechargeAmount=0,a.rechargeOrders.map(function(b){a.rechargeAmount+=b.amount}),a.withdrawAmount=0,a.withdrawOrders.map(function(b){a.withdrawAmount+=b.amount}),a.delta=a.rechargeAmount+a.profitAmount-a.withdrawAmount,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("adminApp").factory("adminApply",["$resource",function(a){var b=a("/admin/api/user/:uid/applies/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("adminApp").factory("adminOrder",["$resource",function(a){var b=a("/admin/api/user/:uid/orders/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("adminApp").factory("gbUser",["$resource",function(a){var b=a("/admin/api/users/:id",{id:"@_id"});return b}]),angular.module("adminApp").factory("gbCachedUsers",["gbUser",function(a){var b=[];return{getUser:function(c,d){var e=_.find(b,{_id:c});e?d(e):a.get({id:c},function(a){b.push(a),d(a)})}}}]),function(){var a=[moment("2015-03-14").dayOfYear(),moment("2015-03-15").dayOfYear(),moment("2015-03-21").dayOfYear(),moment("2015-03-22").dayOfYear(),moment("2015-03-28").dayOfYear(),moment("2015-03-29").dayOfYear(),moment("2015-04-04").dayOfYear(),moment("2015-04-05").dayOfYear(),moment("2015-04-06").dayOfYear(),moment("2015-04-11").dayOfYear(),moment("2015-04-12").dayOfYear(),moment("2015-04-18").dayOfYear(),moment("2015-04-19").dayOfYear(),moment("2015-04-25").dayOfYear(),moment("2015-04-26").dayOfYear(),moment("2015-05-01").dayOfYear(),moment("2015-05-02").dayOfYear(),moment("2015-05-03").dayOfYear(),moment("2015-05-09").dayOfYear(),moment("2015-05-10").dayOfYear(),moment("2015-05-16").dayOfYear(),moment("2015-05-17").dayOfYear(),moment("2015-05-23").dayOfYear(),moment("2015-05-24").dayOfYear(),moment("2015-05-30").dayOfYear(),moment("2015-05-31").dayOfYear(),moment("2015-06-06").dayOfYear(),moment("2015-06-07").dayOfYear(),moment("2015-06-13").dayOfYear(),moment("2015-06-14").dayOfYear(),moment("2015-06-20").dayOfYear(),moment("2015-06-21").dayOfYear(),moment("2015-06-22").dayOfYear(),moment("2015-06-27").dayOfYear(),moment("2015-06-28").dayOfYear(),moment("2015-07-04").dayOfYear(),moment("2015-07-05").dayOfYear(),moment("2015-07-11").dayOfYear(),moment("2015-07-12").dayOfYear(),moment("2015-07-18").dayOfYear(),moment("2015-07-19").dayOfYear(),moment("2015-07-25").dayOfYear(),moment("2015-07-26").dayOfYear(),moment("2015-08-01").dayOfYear(),moment("2015-08-02").dayOfYear(),moment("2015-08-08").dayOfYear(),moment("2015-08-09").dayOfYear(),moment("2015-08-15").dayOfYear(),moment("2015-08-16").dayOfYear(),moment("2015-08-22").dayOfYear(),moment("2015-08-23").dayOfYear(),moment("2015-08-29").dayOfYear(),moment("2015-08-30").dayOfYear(),moment("2015-09-05").dayOfYear(),moment("2015-09-06").dayOfYear(),moment("2015-09-12").dayOfYear(),moment("2015-09-13").dayOfYear(),moment("2015-09-19").dayOfYear(),moment("2015-09-20").dayOfYear(),moment("2015-09-26").dayOfYear(),moment("2015-09-27").dayOfYear(),moment("2015-10-01").dayOfYear(),moment("2015-10-02").dayOfYear(),moment("2015-10-03").dayOfYear(),moment("2015-10-04").dayOfYear(),moment("2015-10-05").dayOfYear(),moment("2015-10-06").dayOfYear(),moment("2015-10-07").dayOfYear(),moment("2015-10-10").dayOfYear(),moment("2015-10-11").dayOfYear(),moment("2015-10-17").dayOfYear(),moment("2015-10-18").dayOfYear(),moment("2015-10-24").dayOfYear(),moment("2015-10-25").dayOfYear(),moment("2015-10-31").dayOfYear(),moment("2015-11-01").dayOfYear(),moment("2015-11-07").dayOfYear(),moment("2015-11-08").dayOfYear(),moment("2015-11-14").dayOfYear(),moment("2015-11-15").dayOfYear(),moment("2015-11-21").dayOfYear(),moment("2015-11-22").dayOfYear(),moment("2015-11-28").dayOfYear(),moment("2015-11-29").dayOfYear(),moment("2015-12-05").dayOfYear(),moment("2015-12-06").dayOfYear(),moment("2015-12-12").dayOfYear(),moment("2015-12-13").dayOfYear(),moment("2015-12-19").dayOfYear(),moment("2015-12-20").dayOfYear(),moment("2015-12-26").dayOfYear(),moment("2015-12-27").dayOfYear()],b=function(){var b=moment().startOf("day");for(moment().hour()>=14&&(b=moment().endOf("day").add(1,"ms"));;){var c=b.dayOfYear();if(-1===a.indexOf(c))break;b=b.add(1,"day")}return b},c=function(b,c,d){var e=b.clone();if(d&&2===d){for(e=e.add(c,"months");-1!==a.indexOf(e.dayOfYear());)e=e.add(1,"day");return e}for(--c;c;)e=e.add(1,"day"),-1===a.indexOf(e.dayOfYear())&&--c;return e.hour(14),e.minute(50),e.second(0),e},d=function(b){for(var c=moment(b).dayOfYear(),d=moment().dayOfYear(),e=0;d>=c;)-1===a.indexOf(d)&&++e,--d;return e};angular.module("commonApp",[]),angular.module("commonApp").value("gbToastr",toastr),angular.module("commonApp").factory("gbNotifier",["gbToastr",function(a){return{notify:function(b){a.success(b)},error:function(b){a.error(b)}}}]),angular.module("commonApp").filter("numTrunc",function(){return function(a){if(a){var b=a.toString(),c=b.search("\\.");c>-1&&(b=b.substr(c))}return b}}).filter("integerNum",function(){return function(a){var b=a,c=b.search("\\.");return c>-1&&(b=b.substr(0,c)),b}}).filter("displayManager",function(){return function(a){switch(a){case"13520978346":return"秦亚景";case"13488867185":return"姜涛";case"17709810065":return"刘恩泽";case"18911347741":return"刘瑞";case"18511565878":return"刘亚东";case"15101183931":return"孟雪";case"18931040286":return"魏昊庚";case"15710035052":return"张丽霞";default:return a}}}).filter("displayOrderAmount",function(){return function(a,b){var c="+";return(2===b||9===b||10===b||11===b||17===b||15===b||19===b||7===b)&&(c="-"),c+a}}).filter("displayIncome",["$filter",function(a){return function(b,c){var d=b;return 2==c||9==c||10==c||11===c||17===c||15==c||19==c||7===c?"":a("currency")(d,"",2)}}]).filter("displayOutcome",["$filter",function(a){return function(b,c){var d="";return(2==c||9==c||10==c||11===c||17===c||15==c||19==c||7===c)&&(d=a("currency")(b,"",2)),d}}]).filter("displayMobile",function(){return function(a){return a?(a=a.toString(),a.substr(0,3)+"****"+a.substr(-4)):""}}).filter("displayEmail",function(){return function(a){if(a){var b=a.search("@");return a.substr(0,2)+"***"+a.substr(b)}return""}}).filter("displayIdentityID",function(){return function(a){return a?a.substr(0,4)+"**********"+a.substr(-4):""}}).filter("displayDate",function(){return function(a){return a?moment(a).format("YYYY-MM-DD HH:mm"):"N/A"}}).filter("displayShortDate",function(){return function(a){return moment(a).format("YYYY-MM-DD")}}).filter("displayCard",["BankNameList",function(a){return function(b){if(b&&b.cardID){var c=b.cardID.toString().substr(12);return a[b.bankID].name+" **** **** **** "+c}return""}}]).filter("displayCard3",function(){return function(a){if(a&&a.cardID){var b=a.cardID.toString().substr(-4),c=a.cardID.toString().substr(0,4);return c+" **** **** "+b}return""}}).filter("displayCard2",["BankNameList",function(){return function(a){if(a&&a.cardID){var b=a.cardID.toString().substr(-4);return b}return""}}]).filter("orderStatus",function(){return function(a){switch(a){case 0:return"等待确认";case 1:return"交易成功";case 2:return"未支付";default:return"未支付"}}}).filter("contractStatus",function(){return function(a){switch(a){case 1:return"进行中";case 2:return"已回款";default:return"未知"}}}).filter("displayOrderType",function(){return function(a){switch(a){case 1:return"充值";case 2:return"提现";case 3:return"盈利提取";case 4:return"股票盈利";case 5:return"保证金返还";case 6:return"保证金支出";case 7:return"管理费支出";case 8:return"管理费返还";case 9:return"保证金支出";case 10:return"管理费支出";case 11:return"投资本金支出";case 12:return"利息收入";case 13:return"推广佣金";case 14:return"佣金兑换余额";case 15:return"穿仓扣除";case 16:return"投资本金返还";case 17:return"余额转入投资本金";case 18:return"投资本金转入余额";case 19:return"融资加配";default:return"充值"}}}).filter("applyStatus",function(){return function(a){switch(a){case 1:return"待支付";case 2:return"操盘中";case 3:return"已结算";case 4:return"审核中";case 5:return"结算中";case 9:return"排队中";default:return"待支付"}}}).filter("payType",function(){return function(a){switch(a){case 0:return"爱贝";case 1:return"盛付通";case 2:return"股票融资盈利";case 3:return"支付宝";case 4:return"银行转账";case 5:return"贝付移动";case 6:return"佣金";case 7:return"牛金";case 8:return"穿仓";case 9:return"易宝";default:return"无"}}}).filter("displayAccountType",function(){return function(a){switch(a){case 2:return"同花顺";case 3:return"牛金操盘";default:return"Homs"}}}).service("days",function(){this.startTime=b,this.endTime=c,this.tradeDaysTillNow=d}).service("util",["warn_factor","sell_factor",function(a,b){this.serviceCharge=19.9,this.getServiceCharge=function(a){switch(a){case 10:return 19.9;case 9:return 18.9;case 8:return 29.9;case 7:return 28.9;case 6:return 27.9;case 5:return 14.9;case 4:return 13.9;case 3:return 10.9;case 2:return 9.9;default:return 19.9}},this.getServiceFee=function(a,b,c){var d=a.discount?a.discount:1;if((0>=d||d>1)&&(d=1),a.type&&2===a.type)return Number((a.amount*a.interestRate*d).toFixed(2));b||(b=a.period);var e=0;return c||(e=a.freeDays>0?a.freeDays:0,b-=e,0>b&&(b=0)),Number((a.amount/1e4*(a.serviceCharge?a.serviceCharge:this.getServiceCharge(a.lever))*b*d).toFixed(2))},this.getWarnValue=function(b,c){return Number((b-a*c).toFixed(2))},this.getSellValue=function(a,c){return Number((a-b*c).toFixed(2))}}]);var e=[{name:"register_content",value:0,content:"验证码：CODE，用于注册，欢迎来到牛金网，为您提供专业贴心的融资服务。"},{name:"reset_pass_content",value:1,content:"验证码：CODE，用于密码重置，请勿泄露给他人！"},{name:"approve_apply_sms_content",value:2,content:"AMOUNT元资金已到账，股票账号ACCOUNT，登录密码PASSWORD，请不要向任何人泄露！"},{name:"close_apply_sms_content",value:3,content:"账户ACCOUNT结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元）已完成，祝您投资愉快。"},{name:"pay_success_sms_content",value:4,content:"充值AMOUNT元成功，请登录查看详情，祝您投资愉快。"},{name:"warn_sms_content",value:5,content:"您的账户（XXXXXXXX）的操盘业务已经亏损到达警戒线，请尽快追加至少XXXX元保证金以维持仓位。"},{name:"sell_sms_content",value:6,content:"账户12345678已经亏损到达平仓线，系统已将其平仓，如需帮助请致电4006921388。"},{name:"withdraw_content",value:7,content:"提现AMOUNT元已完成，请注意查收，如有疑问请致电4006921388。"}];angular.module("commonApp").constant("withdraw_sms_content","您于TIME在牛金网提现AMOUNT元，提现已完成，请注意查收，").constant("get_profit_sms_content","您的盈利提取申请已经处理，资金已划入您在牛金网的余额").constant("approve_apply_sms_content","您有一笔金额为AMOUNT元融资资金已到账，交易账号ACCOUNT，登录密码PASSWORD，您可以通过手机或电脑进行操盘，可以登录牛金网，在我的账户中查看相应账户信息，操盘账户是您操盘的唯一依据，请不要向任何人泄露！").constant("close_apply_sms_content","您在牛金网有一笔TOTAL_AMOUNT元的融资业务已经结算完毕，根据您的操盘收益，该笔融资实际结算AMOUNT元（保证金DEPOSIT元，收益PROFIT元），祝您投资愉快。").constant("pay_success_sms_content","您于TIME在牛金网充值AMOUNT元，资金已经到账，感谢您对牛金网的支持，祝您投资愉快。").constant("warn_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达警戒线WARN_AMOUNT元，请尽快追加保证金以维持仓位，您可以登录牛金网进行操作，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sell_sms_content","您有一笔金额为TOTAL_AMOUNT元的操盘业务已经亏损到达平仓线SELL_AMOUNT元，系统已经将交易账户平仓，请登录牛金网查看相应信息，或者联系QQ客服400 692 1388或电话客服400 692 1388。感谢您对牛金网的支持，祝您投资愉快。").constant("sms_macro",e).constant("service_charge",19.9).constant("warn_factor",.4).constant("sell_factor",.6),angular.module("commonApp").constant("BankNameList",[{name:"工商银行",img:"/images/yh/icbc.jpg",logo:"/mobile/images/yh/icbc_logo.jpg",instCode:"ICBC",credit:!0,value:0},{name:"建设银行",img:"/images/yh/cbc.jpg",logo:"/mobile/images/yh/cbc_logo.jpg",instCode:"CCB",credit:!0,value:1},{name:"农业银行",img:"/images/yh/abc.jpg",logo:"/mobile/images/yh/abc_logo.jpg",instCode:"ABC",credit:!0,value:2},{name:"中国银行",img:"/images/yh/boc.png",logo:"/mobile/images/yh/boc_logo.jpg",instCode:"BOC",credit:!0,value:3},{name:"招商银行",img:"/images/yh/cmb.jpg",logo:"/mobile/images/yh/cmb_logo.jpg",instCode:"CMB",credit:!0,value:4},{name:"交通银行",img:"/images/yh/bcs.png",logo:"/mobile/images/yh/bcs_logo.jpg",instCode:"COMM",credit:!0,value:5},{name:"邮政储蓄银行",img:"/images/yh/psbc.png",logo:"/mobile/images/yh/psbc_logo.jpg",instCode:"PSBC",credit:!1,value:6},{name:"广发银行",img:"/images/yh/cgb.png",logo:"/mobile/images/yh/cgb_logo.jpg",instCode:"GDB",credit:!0,value:7},{name:"光大银行",img:"/images/yh/ceb.png",logo:"/mobile/images/yh/ceb_logo.jpg",instCode:"CEB",credit:!0,value:8},{name:"兴业银行",img:"/images/yh/cib.png",logo:"/mobile/images/yh/cib_logo.jpg",instCode:"CIB",credit:!0,value:9},{name:"北京银行",img:"/images/yh/bob.png",logo:"/mobile/images/yh/bob_logo.jpg",instCode:"BCCB",credit:!1,value:10},{name:"浦发银行",img:"/images/yh/spdb.png",logo:"/mobile/images/yh/spdb_logo.jpg",instCode:"SPDB",credit:!0,value:11},{name:"民生银行",img:"/images/yh/cmbc.png",logo:"/mobile/images/yh/cmbc_logo.jpg",instCode:"CMBC",credit:!0,value:12},{name:"中信银行",img:"/images/yh/ecitic.png",logo:"/mobile/images/yh/ecitic_logo.jpg",instCode:"CITIC",credit:!0,value:13},{name:"华夏银行",img:"/images/yh/hx-2.png",logo:"/mobile/images/yh/hx_logo.jpg",instCode:"HXB",credit:!1,value:14},{name:"平安银行",img:"/images/yh/pa.png",logo:"/mobile/images/yh/pa_logo.jpg",instCode:"SZPAB",credit:!0,value:15},{name:"宁波银行",img:"/images/yh/nbcb.png",logo:"/mobile/images/yh/nbcb_logo.jpg",instCode:"NBCB",credit:!1,value:16},{name:"上海银行",img:"/images/yh/bos.png",logo:"/mobile/images/yh/bos_logo.jpg",instCode:"BOS",credit:!0,value:17}]),angular.module("commonApp").factory("njUser",["$resource",function(a){var b=a("/api/user/:id",{id:"@_id"});return b}]),angular.module("commonApp").factory("njApply",["$resource",function(a){var b=a("/api/user/:uid/applies/:serial_id",{uid:"@userID",serial_id:"@serialID"});return b}]),angular.module("commonApp").factory("njOrder",["$resource",function(a){var b=a("/api/user/:uid/orders/:id",{uid:"@userID",id:"@_id"});return b}]),angular.module("commonApp").factory("njCard",["$resource",function(a){var b=a("/api/cards/:uid",{userID:"@uid"});return b}]),angular.module("commonApp").factory("njCachedCards",["njCard",function(a){var b,c;return{setUID:function(a){c=a},query:function(){return b||(b=a.query({uid:c})),b}}}])}();