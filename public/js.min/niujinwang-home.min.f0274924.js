"use strict";angular.module("applyApp",[]),angular.module("applyApp").controller("ApplyController",["$http","$location","$window",function(a,b,c){function d(){h.summary.warnValue=h.summary.amount*i,h.summary.sellValue=h.summary.amount*j,h.summary.deposit=h.summary.amount*k;var a=h.summary.amount/1e4*l*h.summary.day;h.summary.charge=a,h.summary.total=h.summary.deposit+a}function e(){angular.forEach(h.amountList,function(a){a.select=!1})}function f(){angular.forEach(h.dayList,function(a){a.select=!1})}function g(){h.summary.amount=h.otherAmount>=2e3?Math.floor(h.otherAmount):h.otherAmount=2e3,d()}var h=this,i=.93,j=.95,k=.1,l=18.8;h.agree=!0,h.showOtherAmount=!1,h.otherAmount=2e3,h.summary={day:5,amount:5e4},d(),h.amountList=[{name:"2000元",value:"2000"},{name:"1万",value:"10000"},{name:"3万",value:"30000"},{name:"5万",value:"50000",select:!0},{name:"10万",value:"100000"},{name:"30万",value:"300000"}],h.dayList=[{value:"2"},{value:"5",select:!0},{value:"8"},{value:"10"}],h.selectAmount=function(a){e(),h.showOtherAmount=!1,h.otherAmount=0,a.select=!0,h.summary.amount=a.value,d()},h.selectDay=function(a){f(),a.select=!0,h.summary.day=a.value,d()},h.toggleOtherAmount=function(){e(),h.showOtherAmount=!h.showOtherAmount,g()},h.finishOtherAmount=function(){g()},h.submitApply=function(){a.post("/apply",h.summary).then(function(a){a.data.success?c.location.href="/apply_confirm/"+a.data.apply_id:"not authenticate"===a.data.reason&&(c.location.href="/login")})}}]),$(document).ready(function(){moment.locale("zh-cn"),$(".verify-code-btn").click(function(){var a=$(this);console.log(a[0].innerText);var b=0;a.addClass("am-disabled");var c=setInterval(function(){++b,a[0].innerText=60-b+"秒后重试",60==b&&(clearInterval(c),a[0].innerText="获取验证码")},1e3);return}),$("#go-to-pay").on("click",function(a){a.preventDefault(),window.open("/third_party_pay"),$("#pay-confirm").modal({relatedTarget:this,onConfirm:function(){var a=$("#pay_amount")[0].value;$.post("/api/users/update_balance",{pay_amount:a},function(a){if(a.success){var b=$("#total_amount")[0].value,c=$("#apply_id")[0].value;$.post("/api/users/pay_by_balance",{pay_amount:b,apply_id:c},function(a){window.location.replace(a.success?"/thank_you_for_pay":"/failed_to_pay")})}else window.location.replace("/failed_to_pay")})},onCancel:function(){window.location.replace("/support_contact")}})}),$("#go-to-use-balance").on("click",function(a){a.preventDefault();var b=$("form").serialize();$.post("/api/users/pay_by_balance",b,function(a){window.location.replace(a.success?"/thank_you_for_pay":"/failed_to_pay")})})});